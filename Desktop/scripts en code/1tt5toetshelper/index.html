<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#667eea">
    <title>4ward</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="favicon_4ward.png">
    <link rel="apple-touch-icon" href="favicon_4ward.png">
    
    <!-- Preconnect for faster loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    
    <!-- Google Fonts - only load 2 weights instead of 5 -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google AdSense - UITGESCHAKELD VOOR TESTEN (verwijder commentaar voor productie)
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3308897107941765"
         crossorigin="anonymous"></script>
    -->
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'poppins': ['Poppins', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        * { font-family: 'Poppins', sans-serif; }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }
        .btn-success:hover {
            box-shadow: 0 10px 30px rgba(17, 153, 142, 0.4);
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #4a64d6 0%, #764ba2 100%);
            transition: width 0.5s ease;
        }
        
        /* Loading spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 0.8s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .bounce-in {
            animation: bounceIn 0.5s ease;
        }
        @keyframes bounceIn {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .option-btn {
            transition: all 0.2s ease;
        }
        .option-btn:hover:not(:disabled) {
            transform: scale(1.02);
            border-color: #667eea;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
        }
        .option-btn:disabled {
            cursor: not-allowed;
        }
        .option-correct {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%) !important;
            border-color: #28a745 !important;
            color: #155724 !important;
        }
        .option-wrong {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%) !important;
            border-color: #dc3545 !important;
            color: #721c24 !important;
        }
        
        .match-btn {
            transition: all 0.2s ease;
        }
        .match-btn.selected {
            transform: scale(1.05);
        }
        .match-btn.matched {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Mobile optimizations */
        @media (max-width: 640px) {
            body {
                padding: 8px;
            }
            .glass {
                padding: 16px;
                border-radius: 16px;
            }
            h1 {
                font-size: 1.75rem !important;
            }
            .option-btn, .match-btn {
                padding: 12px !important;
                font-size: 14px !important;
            }
            button {
                -webkit-tap-highlight-color: transparent;
            }
        }
        
        /* Prevent text selection on buttons for mobile */
        button {
            -webkit-user-select: none;
            user-select: none;
        }
        
        /* Safe area for notched phones */
        @supports (padding: env(safe-area-inset-bottom)) {
            body {
                padding-bottom: env(safe-area-inset-bottom);
            }
        }
        
        /* Memory card styling */
        .memory-card {
            perspective: 1000px;
        }
        .memory-card-inner {
            transition: transform 0.3s;
            transform-style: preserve-3d;
        }
        
        /* Speed quiz timer pulse when low */
        @keyframes pulse-red {
            0%, 100% { color: #dc2626; }
            50% { color: #ef4444; transform: scale(1.1); }
        }
        .timer-warning {
            animation: pulse-red 0.5s infinite;
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">
    
    <div id="app" class="max-w-2xl md:max-w-4xl mx-auto">
        
        <!-- ==================== AUTO-LOGIN SCREEN ==================== -->
        <div id="screen-autologin" class="hidden glass rounded-3xl shadow-2xl p-8 fade-in">
            <div class="text-center py-12">
                <h1 class="text-4xl md:text-5xl font-extrabold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-4">
                    4ward
                </h1>
                <div class="mb-6">
                    <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-purple-500 border-t-transparent"></div>
                </div>
                <p class="text-xl text-gray-600 mb-2">Welkom terug!</p>
                <p id="autologin-name" class="text-2xl font-bold text-purple-600"></p>
                <p class="text-gray-500 mt-4">Even je sterren ophalen... â­</p>
            </div>
        </div>
        
        <!-- ==================== LOGIN SCREEN ==================== -->
        <div id="screen-login" class="glass rounded-3xl shadow-2xl p-8 fade-in">
            <div class="text-center mb-8">
                <h1 class="text-4xl md:text-5xl font-extrabold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-2">
                    4ward
                </h1>
                <p class="text-gray-500 text-lg">Log in om te beginnen</p>
            </div>
            
            <div class="max-w-sm mx-auto">
                <div class="mb-4">
                    <label class="block text-gray-700 font-semibold mb-2">Jouw naam</label>
                    <input type="text" id="login-name" 
                        class="w-full p-4 text-lg border-2 border-gray-300 rounded-xl focus:border-indigo-500 focus:outline-none"
                        placeholder="Vul je naam in..." maxlength="20" autocomplete="off">
                </div>
                
                <!-- Emoji Password -->
                <div class="mb-6">
                    <label class="block text-gray-700 font-semibold mb-2">Emoji wachtwoord (3 emoji's)</label>
                    <div id="login-emoji-display" class="w-full p-4 text-3xl bg-white border-2 border-gray-300 rounded-xl min-h-[60px] flex items-center justify-center gap-2 mb-3">
                        <span class="text-gray-300">Kies 3 emoji's...</span>
                    </div>
                    <div id="login-emoji-grid" class="grid grid-cols-6 gap-2">
                        <!-- Emoji buttons worden door JS gegenereerd -->
                    </div>
                    <button onclick="Auth.clearEmojiPassword('login')" class="mt-2 text-sm text-gray-500 hover:text-red-500">ğŸ—‘ï¸ Wissen</button>
                </div>
                
                <button id="login-btn" onclick="Auth.login()" class="w-full btn-primary text-white font-bold py-4 rounded-xl text-lg shadow-lg flex items-center justify-center gap-2">
                    <span id="login-btn-text">ğŸ” Inloggen</span>
                    <span id="login-spinner" class="hidden loading-spinner"></span>
                </button>
                
                <p id="login-error" class="text-red-500 text-sm mt-3 text-center hidden"></p>
                
                <div class="text-center mt-4">
                    <span class="text-gray-500">Nog geen account?</span>
                    <button onclick="Auth.showRegister()" class="text-indigo-600 hover:text-indigo-800 font-semibold ml-1">Registreren</button>
                </div>
            </div>
            
            <!-- Info -->
            <div class="mt-6 p-4 bg-indigo-50 border-l-4 border-indigo-400 rounded-xl">
                <p class="text-indigo-800 text-sm">
                    <strong>ğŸ’¡ Waarom emoji wachtwoord?</strong> Makkelijk te onthouden en veilig! Kies 3 emoji's die alleen jij kent.
                </p>
            </div>
        </div>
        
        <!-- ==================== REGISTER SCREEN ==================== -->
        <div id="screen-register" class="glass rounded-3xl shadow-2xl p-8 fade-in hidden">
            <div class="text-center mb-6">
                <h1 class="text-4xl md:text-5xl font-extrabold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-2">
                    4ward
                </h1>
                <p class="text-gray-500 text-lg">Maak een nieuw account</p>
            </div>
            
            <div class="max-w-sm mx-auto">
                <!-- Echte naam -->
                <div class="mb-4">
                    <label class="block text-gray-700 font-semibold mb-2">ğŸ‘¤ Je echte voornaam</label>
                    <input type="text" id="register-real-name" 
                        class="w-full p-4 text-lg border-2 border-gray-300 rounded-xl focus:border-indigo-500 focus:outline-none"
                        placeholder="Bijv. Rune, Elena..." maxlength="20" autocomplete="off">
                    <p class="text-gray-400 text-xs mt-1">Zodat je leerkracht weet wie je bent</p>
                </div>
                
                <!-- Grappige naam -->
                <div class="mb-4">
                    <label class="block text-gray-700 font-semibold mb-2">ğŸ® Kies een leuke gebruikersnaam <span class="text-gray-400 font-normal">(optioneel)</span></label>
                    <input type="text" id="register-name" 
                        class="w-full p-4 text-lg border-2 border-gray-300 rounded-xl focus:border-indigo-500 focus:outline-none"
                        placeholder="Bijv. coolguy, coolgirl ..." maxlength="20" autocomplete="off">
                    <p class="text-gray-400 text-xs mt-1">Laat leeg om alleen je voornaam te gebruiken</p>
                </div>
                
                <!-- Emoji Password -->
                <div class="mb-6">
                    <label class="block text-gray-700 font-semibold mb-2">ğŸ” Maak een emoji wachtwoord (3 emoji's)</label>
                    <div id="register-emoji-display" class="w-full p-4 text-3xl bg-white border-2 border-gray-300 rounded-xl min-h-[60px] flex items-center justify-center gap-2 mb-3">
                        <span class="text-gray-300">Kies 3 emoji's...</span>
                    </div>
                    <div id="register-emoji-grid" class="grid grid-cols-6 gap-2">
                        <!-- Emoji buttons worden door JS gegenereerd -->
                    </div>
                    <button onclick="Auth.clearEmojiPassword('register')" class="mt-2 text-sm text-gray-500 hover:text-red-500">ğŸ—‘ï¸ Wissen</button>
                </div>
                
                <button id="register-btn" onclick="Auth.register()" class="w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-4 rounded-xl text-lg shadow-lg transition-all flex items-center justify-center gap-2">
                    <span id="register-btn-text">âœ¨ Account aanmaken</span>
                    <span id="register-spinner" class="hidden loading-spinner"></span>
                </button>
                
                <p id="register-error" class="text-red-500 text-sm mt-3 text-center hidden"></p>
                <p id="register-success" class="text-green-600 text-sm mt-3 text-center hidden"></p>
                
                <div class="text-center mt-4">
                    <span class="text-gray-500">Al een account?</span>
                    <button onclick="Auth.showLogin()" class="text-indigo-600 hover:text-indigo-800 font-semibold ml-1">Inloggen</button>
                </div>
            </div>
            
            <!-- Waarschuwing -->
            <div class="mt-4 p-4 bg-amber-50 border-l-4 border-amber-400 rounded-xl">
                <p class="text-amber-800 text-sm">
                    <strong>âš ï¸ Belangrijk!</strong> Gebruik je echte voornaam zodat je leerkracht je kan herkennen. 
                    Als je een nepnaam gebruikt, kan je account worden gereset!
                </p>
            </div>
            
            <!-- Info -->
            <div class="mt-3 p-4 bg-green-50 border-l-4 border-green-400 rounded-xl">
                <p class="text-green-800 text-sm">
                    <strong>ğŸ”’ Onthoud je emoji's!</strong> Je hebt ze nodig om later in te loggen. Vertel ze aan niemand!
                </p>
            </div>
        </div>
        
        <!-- ==================== HOME SCREEN ==================== -->
        <div id="screen-home" class="glass rounded-3xl shadow-2xl p-8 fade-in hidden">
            <!-- User Info Bar -->
            <div class="flex justify-between items-center mb-4 p-3 bg-gradient-to-r from-indigo-100 to-purple-100 rounded-xl">
                <div class="flex items-center gap-2">
                    <span class="text-2xl">ğŸ‘‹</span>
                    <span class="font-semibold text-gray-700">Hallo, <span id="user-display-name">Gebruiker</span>!</span>
                </div>
                <button onclick="Auth.logout()" class="text-sm text-gray-500 hover:text-red-500 transition-colors">
                    Uitloggen
                </button>
            </div>
            
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 class="text-4xl md:text-5xl font-extrabold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-2">
                    4ward
                </h1>
                <p class="text-gray-500 text-lg">Kies een vak om te oefenen</p>
            </div>
            
            <!-- Stats Bar -->
            <div class="flex justify-center gap-4 mb-8 flex-wrap">
                <button onclick="App.showStats()" class="flex items-center gap-2 px-5 py-2.5 bg-indigo-100 text-indigo-700 rounded-xl font-semibold hover:bg-indigo-200 transition-all shadow-md">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg>
                    Statistieken
                </button>
                <button onclick="App.showLeaderboard()" class="flex items-center gap-2 px-5 py-2.5 bg-amber-100 text-amber-700 rounded-xl font-semibold hover:bg-amber-200 transition-all shadow-md">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
                    </svg>
                    Leaderboard
                </button>
                <button id="teacher-dashboard-btn" onclick="App.showTeacherDashboard()" class="hidden flex items-center gap-2 px-5 py-2.5 bg-emerald-100 text-emerald-700 rounded-xl font-semibold hover:bg-emerald-200 transition-all shadow-md">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                    </svg>
                    ğŸ‘¨â€ğŸ« Leerlingen
                </button>
                <div class="flex items-center gap-2 px-5 py-2.5 bg-yellow-100 text-yellow-700 rounded-xl font-semibold shadow-md">
                    <svg class="w-5 h-5 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.802 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.802-2.034a1 1 0 00-1.176 0l-2.802 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                    </svg>
                    <span id="star-count">0</span> sterren
                </div>
            </div>
            
            <!-- Subject Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                <!-- Frans -->
                <button onclick="App.selectSubject('frans')" class="card-hover p-8 bg-gradient-to-br from-blue-500 to-blue-700 text-white rounded-2xl shadow-lg text-center">
                    <span class="text-5xl mb-4 block">ğŸ‡«ğŸ‡·</span>
                    <span class="text-2xl font-bold block">Frans</span>
                    <span class="text-blue-200 text-sm mt-2 block">Woordenschat oefenen</span>
                </button>
                
                <!-- Wiskunde -->
                <button onclick="App.selectSubject('wiskunde')" class="card-hover p-8 bg-gradient-to-br from-orange-500 to-pink-600 text-white rounded-2xl shadow-lg text-center">
                    <span class="text-5xl mb-4 block">ğŸ“</span>
                    <span class="text-2xl font-bold block">Wiskunde</span>
                    <span class="text-orange-200 text-sm mt-2 block">Schatten & Meten</span>
                </button>
                
                <!-- Natuurwetenschappen -->
                <button onclick="App.selectSubject('natuur')" class="card-hover p-8 bg-gradient-to-br from-green-500 to-emerald-700 text-white rounded-2xl shadow-lg text-center">
                    <span class="text-5xl mb-4 block">ğŸ¦</span>
                    <span class="text-2xl font-bold block">Natuur</span>
                    <span class="text-green-200 text-sm mt-2 block">Aanpassingen & Zintuigen</span>
                </button>
            </div>
            
            <!-- Games Section -->
            <div class="mt-6">
                <h3 class="text-lg font-bold text-gray-700 mb-3 flex items-center gap-2">
                    ğŸ® Spelletjes
                    <span class="text-xs font-normal text-gray-500">(unlock bij 10 â­)</span>
                </h3>
                <div id="games-section" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Memory Game -->
                    <button onclick="App.playGame('memory')" id="game-memory" class="card-hover p-6 bg-gradient-to-br from-green-500 to-teal-600 text-white rounded-2xl shadow-lg text-center relative overflow-hidden disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        <div id="game-memory-lock" class="absolute inset-0 bg-black/40 flex items-center justify-center">
                            <span class="text-3xl">ğŸ”’</span>
                        </div>
                        <span class="text-4xl mb-3 block">ğŸ§ </span>
                        <span class="text-xl font-bold block">Memory</span>
                        <span class="text-green-200 text-xs mt-1 block">Onthoud de paren!</span>
                    </button>
                    
                    <!-- Speed Type -->
                    <button onclick="App.playGame('speedquiz')" id="game-speedquiz" class="card-hover p-6 bg-gradient-to-br from-red-500 to-orange-600 text-white rounded-2xl shadow-lg text-center relative overflow-hidden disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        <div id="game-speedquiz-lock" class="absolute inset-0 bg-black/40 flex items-center justify-center">
                            <span class="text-3xl">ğŸ”’</span>
                        </div>
                        <span class="text-4xl mb-3 block">âŒ¨ï¸</span>
                        <span class="text-xl font-bold block">Speed Type</span>
                        <span class="text-red-200 text-xs mt-1 block">Typ zo snel mogelijk!</span>
                    </button>
                </div>
            </div>
            
            <!-- Waarschuwing -->
            <div class="mt-6 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded-xl">
                <p class="text-yellow-800 text-sm">
                    <strong>âš ï¸ Let op:</strong> Deze website is niet genoeg om te studeren! Kijk op <strong>Smartschool</strong> hoe je het best kunt studeren.
                </p>
            </div>
            
            <!-- Suggestie box -->
            <div class="mt-4 p-4 bg-indigo-50 border-l-4 border-indigo-400 rounded-xl">
                <p class="text-indigo-800 text-sm">
                    <strong>ğŸ’¡ Wil je oefenen voor iets?</strong> Vertel het aan mij (Rune) en ik probeer het toe te voegen!
                </p>
            </div>
            
            <!-- Footer -->
            <div class="mt-8 pt-6 border-t border-gray-200 text-center">
                <p class="text-gray-400 text-sm">Gemaakt door <strong>Rune Claes</strong></p>
                <p class="text-gray-400 text-xs mt-1">Versie 2.0</p>
            </div>
        </div>
        
        <!-- ==================== TOPIC SELECTION ==================== -->
        <div id="screen-topics" class="glass rounded-3xl shadow-2xl p-8 hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 id="topics-title" class="text-2xl font-bold text-gray-800">Kies onderwerp</h2>
                <button onclick="App.goHome()" class="text-indigo-600 hover:text-indigo-800 font-semibold flex items-center gap-1">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                    Terug
                </button>
            </div>
            <div id="topics-buttons" class="space-y-4">
                <!-- Dynamisch gevuld -->
            </div>
        </div>
        
        <!-- ==================== MODE SELECTION ==================== -->
        <div id="screen-modes" class="glass rounded-3xl shadow-2xl p-8 hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 id="modes-title" class="text-2xl font-bold text-gray-800">Kies oefenmodus</h2>
                <button onclick="App.goToTopics()" class="text-indigo-600 hover:text-indigo-800 font-semibold flex items-center gap-1">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                    Terug
                </button>
            </div>
            <div id="modes-buttons" class="space-y-4">
                <!-- Dynamisch gevuld -->
            </div>
        </div>
        
        <!-- ==================== QUIZ SCREEN ==================== -->
        <div id="screen-quiz" class="glass rounded-3xl shadow-2xl p-8 hidden">
            <!-- Quiz Header -->
            <div class="flex justify-between items-center mb-4">
                <h2 id="quiz-title" class="text-xl font-bold text-gray-800">Quiz</h2>
                <button onclick="App.exitQuiz()" class="text-indigo-600 hover:text-indigo-800 font-semibold flex items-center gap-1">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                    Stop
                </button>
            </div>
            
            <!-- Progress -->
            <div class="mb-6">
                <div class="flex justify-between text-sm text-gray-600 mb-2">
                    <span id="quiz-progress">Vraag 1 van 10</span>
                    <span id="quiz-score" class="font-semibold">Score: 0/0</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                    <div id="quiz-progress-bar" class="progress-bar h-3 rounded-full" style="width: 0%"></div>
                </div>
            </div>
            
            <!-- Question Card -->
            <div id="question-card" class="bg-gradient-to-br from-indigo-50 to-purple-50 border-l-4 border-indigo-500 p-6 rounded-2xl mb-6">
                <p id="question-label" class="text-sm text-indigo-600 font-medium mb-2">Vraag:</p>
                <p id="question-text" class="text-2xl font-bold text-gray-800"></p>
            </div>
            
            <!-- Answer Options (MC) -->
            <div id="mc-options" class="space-y-3 hidden">
                <!-- Dynamisch gevuld -->
            </div>
            
            <!-- Typing Input -->
            <div id="typing-area" class="hidden">
                <input type="text" id="answer-input" placeholder="Typ je antwoord hier..." 
                    class="w-full p-4 text-xl border-2 border-gray-300 rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none transition-all">
                <button onclick="Quiz.checkTypedAnswer()" id="check-btn" class="w-full mt-4 btn-primary text-white font-bold py-4 rounded-xl shadow-lg">
                    âœ“ Controleer
                </button>
            </div>
            
            <!-- Matching Game -->
            <div id="matching-area" class="hidden">
                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <p class="text-center font-bold text-gray-600 mb-3">ğŸ¯ Object</p>
                        <div id="match-left" class="space-y-2"></div>
                    </div>
                    <div>
                        <p class="text-center font-bold text-gray-600 mb-3">ğŸ“ Afmeting</p>
                        <div id="match-right" class="space-y-2"></div>
                    </div>
                </div>
                <p class="text-center text-gray-500 text-sm mt-4">Klik op een object en dan op de juiste afmeting</p>
            </div>
            
            <!-- Feedback Area -->
            <div id="feedback-area" class="mt-6"></div>
        </div>
        
        <!-- ==================== RESULTS MODAL ==================== -->
        <div id="modal-results" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50 hidden">
            <div class="glass rounded-3xl shadow-2xl p-8 max-w-md w-full bounce-in text-center">
                <div class="text-6xl mb-4">ğŸ‰</div>
                <h3 class="text-3xl font-bold text-gray-800 mb-2">Quiz Voltooid!</h3>
                <p id="results-score" class="text-5xl font-extrabold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent my-6">0/0</p>
                <p id="results-percentage" class="text-xl text-gray-600 mb-6">0% correct</p>
                
                <div class="flex flex-col gap-3">
                    <button onclick="App.restartQuiz()" class="btn-success text-white font-bold py-3 px-6 rounded-xl shadow-lg hover:scale-105 transition-transform">
                        ğŸ”„ Opnieuw oefenen
                    </button>
                    <button onclick="App.goHome()" class="bg-gray-200 text-gray-700 font-bold py-3 px-6 rounded-xl shadow-lg hover:bg-gray-300 transition-all">
                        ğŸ  Naar home
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ==================== STATS MODAL ==================== -->
        <div id="modal-stats" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50 hidden" onclick="App.hideStats()">
            <div class="glass rounded-3xl shadow-2xl p-8 max-w-lg w-full max-h-[80vh] overflow-y-auto" onclick="event.stopPropagation()">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">ğŸ“Š Statistieken</h3>
                    <button onclick="App.hideStats()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                </div>
                
                <!-- Overview Stats -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-indigo-50 p-4 rounded-xl text-center">
                        <p class="text-3xl font-bold text-indigo-600" id="stats-total">0</p>
                        <p class="text-sm text-indigo-500">Quizzes gedaan</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-xl text-center">
                        <p class="text-3xl font-bold text-green-600" id="stats-average">0%</p>
                        <p class="text-sm text-green-500">Gemiddelde score</p>
                    </div>
                </div>
                
                <!-- Topic Stats -->
                <div id="stats-topics" class="space-y-3 mb-6">
                    <!-- Dynamisch gevuld -->
                </div>
                
                <!-- Reset Button -->
                <button onclick="App.resetStats()" class="w-full bg-red-100 text-red-600 font-semibold py-3 rounded-xl hover:bg-red-200 transition-all">
                    ğŸ—‘ï¸ Reset alle statistieken
                </button>
            </div>
        </div>
        
        <!-- ==================== LEADERBOARD MODAL ==================== -->
        <div id="modal-leaderboard" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50 hidden" onclick="App.hideLeaderboard()">
            <div class="glass rounded-3xl shadow-2xl p-4 sm:p-8 max-w-lg w-full max-h-[80vh] overflow-y-auto mx-4" onclick="event.stopPropagation()">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl sm:text-2xl font-bold text-gray-800">ğŸ† Leaderboard</h3>
                    <button onclick="App.hideLeaderboard()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                </div>
                
                <!-- Add to leaderboard -->
                <div id="leaderboard-add" class="mb-6 p-3 sm:p-4 bg-gradient-to-r from-amber-50 to-yellow-50 rounded-xl border-2 border-amber-200 overflow-hidden">
                    <p class="text-amber-800 font-semibold mb-3 text-sm sm:text-base">â­ Voeg jezelf toe aan het leaderboard!</p>
                    <div class="flex flex-col gap-2">
                        <div class="w-full p-3 bg-white border-2 border-amber-300 rounded-xl text-sm sm:text-base">
                            <span class="text-gray-500">Naam:</span> <strong id="leaderboard-display-name" class="text-gray-800">...</strong>
                        </div>
                        <button onclick="App.addToLeaderboard()" class="w-full py-3 bg-gradient-to-r from-amber-500 to-yellow-500 text-white font-bold rounded-xl hover:scale-105 transition-transform shadow-lg text-sm sm:text-base">
                            Toevoegen aan Leaderboard
                        </button>
                    </div>
                    <p class="text-amber-600 text-xs mt-2">Je huidige sterren: <strong id="current-stars-display">0</strong></p>
                </div>
                
                <!-- Leaderboard List -->
                <div id="leaderboard-list" class="space-y-2">
                    <!-- Dynamisch gevuld -->
                </div>
            </div>
        </div>
        
        <!-- ==================== TEACHER DASHBOARD MODAL ==================== -->
        <div id="modal-teacher" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50 hidden" onclick="App.hideTeacherDashboard()">
            <div class="glass rounded-3xl shadow-2xl p-4 sm:p-8 max-w-2xl w-full max-h-[85vh] overflow-y-auto mx-4" onclick="event.stopPropagation()">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl sm:text-2xl font-bold text-gray-800">ğŸ‘¨â€ğŸ« Leerlingen Overzicht</h3>
                    <button onclick="App.hideTeacherDashboard()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                </div>
                
                <p class="text-gray-500 text-sm mb-4">Bekijk en bewerk de voortgang van leerlingen</p>
                
                <!-- Students List -->
                <div id="teacher-students-list" class="space-y-3">
                    <p class="text-center text-gray-500 py-4">Laden...</p>
                </div>
            </div>
        </div>
        
        <!-- ==================== EDIT STUDENT MODAL ==================== -->
        <div id="modal-edit-student" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-[60] hidden" onclick="App.hideEditStudent()">
            <div class="glass rounded-3xl shadow-2xl p-6 max-w-md w-full mx-4" onclick="event.stopPropagation()">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800">âœï¸ Leerling Bewerken</h3>
                    <button onclick="App.hideEditStudent()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                </div>
                
                <div class="space-y-4">
                    <input type="hidden" id="edit-student-original-name">
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">ğŸ‘¤ Naam</label>
                        <input type="text" id="edit-student-name" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none" placeholder="Naam van de leerling">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">â­ Sterren</label>
                        <input type="number" id="edit-student-stars" min="0" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none" placeholder="Aantal sterren">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">ğŸ” Huidig Wachtwoord</label>
                        <div id="current-password-display" class="w-full p-3 bg-gray-100 border-2 border-gray-200 rounded-xl min-h-[50px] flex items-center justify-center gap-2">
                            <span class="text-gray-400 text-sm">Laden...</span>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">ğŸ”‘ Nieuw Wachtwoord (optioneel)</label>
                        <div id="edit-emoji-display" class="w-full p-3 text-2xl bg-white border-2 border-gray-200 rounded-xl min-h-[50px] flex items-center justify-center gap-2 mb-2">
                            <span class="text-gray-300 text-sm">Kies 3 emoji's om wachtwoord te resetten...</span>
                        </div>
                        <div id="edit-emoji-grid" class="grid grid-cols-6 gap-1 mb-2">
                            <!-- Emoji buttons worden door JS gegenereerd -->
                        </div>
                        <button onclick="App.clearEditEmojiPassword()" class="text-sm text-gray-500 hover:text-red-500">ğŸ—‘ï¸ Wissen</button>
                        <p class="text-xs text-gray-500 mt-1">Laat leeg om het wachtwoord niet te wijzigen</p>
                    </div>
                    
                    <div class="flex gap-3 pt-4">
                        <button onclick="App.hideEditStudent()" class="flex-1 p-3 bg-gray-200 text-gray-700 rounded-xl font-semibold hover:bg-gray-300 transition-colors">
                            Annuleren
                        </button>
                        <button onclick="App.saveStudentEdit()" id="save-student-btn" class="flex-1 p-3 btn-primary text-white rounded-xl font-semibold">
                            ğŸ’¾ Opslaan
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ==================== MEMORY GAME SCREEN ==================== -->
        <div id="screen-memory" class="glass rounded-3xl shadow-2xl p-4 sm:p-8 hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">ğŸ§  Memory</h2>
                <button onclick="App.goHome()" class="text-indigo-600 hover:text-indigo-800 font-semibold flex items-center gap-1">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                    Terug
                </button>
            </div>
            <div class="text-center mb-4">
                <p class="text-gray-600">Vind alle paren! <span id="memory-moves" class="font-bold">0</span> zetten</p>
                <p class="text-gray-500 text-sm">Tijd: <span id="memory-timer">0:00</span></p>
            </div>
            <div id="memory-grid" class="grid grid-cols-4 gap-2 sm:gap-3 max-w-md mx-auto">
                <!-- Memory cards worden hier gegenereerd -->
            </div>
            <div id="memory-complete" class="hidden text-center mt-6 p-6 bg-green-100 rounded-xl">
                <h3 class="text-2xl font-bold text-green-700 mb-2">ğŸ‰ Gewonnen!</h3>
                <p class="text-green-600">Je deed het in <span id="memory-final-moves">0</span> zetten en <span id="memory-final-time">0:00</span>!</p>
                <button onclick="Games.startMemory()" class="mt-4 px-6 py-3 bg-green-500 text-white font-bold rounded-xl hover:bg-green-600 transition-all">
                    Opnieuw spelen
                </button>
            </div>
        </div>
        
        <!-- ==================== SPEED TYPE SCREEN ==================== -->
        <div id="screen-speedquiz" class="glass rounded-3xl shadow-2xl p-4 sm:p-8 hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">âŒ¨ï¸ Speed Type</h2>
                <button onclick="App.goHome()" class="text-indigo-600 hover:text-indigo-800 font-semibold flex items-center gap-1">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                    Terug
                </button>
            </div>
            <div class="text-center mb-6">
                <div class="text-6xl font-bold text-indigo-600 mb-2" id="speedquiz-timer">30</div>
                <p class="text-gray-500">seconden over</p>
                <p class="text-2xl font-bold text-green-600 mt-2">Woorden: <span id="speedquiz-score">0</span></p>
            </div>
            <div id="speedquiz-question" class="text-center mb-6">
                <p class="text-4xl font-bold text-gray-800 tracking-wide" id="speedquiz-vraag">Druk op Start!</p>
            </div>
            <div id="speedquiz-options" class="max-w-md mx-auto">
                <input type="text" id="speedtype-input" 
                    class="w-full p-4 text-2xl text-center border-4 border-indigo-300 rounded-xl focus:border-indigo-500 focus:outline-none font-mono"
                    placeholder="Type hier..." autocomplete="off" autocapitalize="off" spellcheck="false">
                <p class="text-sm text-gray-500 mt-2 text-center">Typ het woord en druk op Enter of Spatie</p>
            </div>
            <div id="speedquiz-start" class="text-center mt-4">
                <button onclick="Games.startSpeedQuiz()" class="px-8 py-4 bg-gradient-to-r from-red-500 to-orange-500 text-white font-bold text-xl rounded-xl hover:scale-105 transition-transform shadow-lg">
                    ğŸš€ Start!
                </button>
            </div>
            <div id="speedquiz-complete" class="hidden text-center mt-6 p-6 bg-orange-100 rounded-xl">
                <h3 class="text-2xl font-bold text-orange-700 mb-2">â±ï¸ Tijd voorbij!</h3>
                <p class="text-orange-600 text-xl">Je typte <span id="speedquiz-final-score" class="font-bold">0</span> woorden correct!</p>
                <button onclick="Games.startSpeedQuiz()" class="mt-4 px-6 py-3 bg-orange-500 text-white font-bold rounded-xl hover:bg-orange-600 transition-all">
                    Opnieuw spelen
                </button>
            </div>
        </div>
        
    </div>

<script>
// ============================================================
// DATA
// ============================================================
const DATA = {
    wiskunde: {
        schatting: {
            mc: [
                { vraag: "Wat is de beste schatting voor de hoogte van een deur?", a: "1 meter", b: "2 meter", c: "3 meter", d: "5 meter", antwoord: "b", uitleg: "Een standaarddeur is ongeveer 2 meter hoog." },
                { vraag: "Welke maateenheid gebruik je voor de lengte van een potlood?", a: "kilometer", b: "meter", c: "centimeter", d: "millimeter", antwoord: "c", uitleg: "Een potlood is ongeveer 19 centimeter lang." },
                { vraag: "Wat is de beste schatting voor de lengte van een auto?", a: "4 meter", b: "8 meter", c: "12 meter", d: "20 meter", antwoord: "a", uitleg: "Een auto is ongeveer 4 meter lang." },
                { vraag: "Hoe lang is een voetbalveld ongeveer?", a: "50 meter", b: "100 meter", c: "150 meter", d: "200 meter", antwoord: "b", uitleg: "Een voetbalveld is ongeveer 100 meter lang." },
                { vraag: "Welke maateenheid is geschikt voor de dikte van een paperclip?", a: "meter", b: "centimeter", c: "millimeter", d: "kilometer", antwoord: "c", uitleg: "Een paperclip is 1-2 millimeter dik." },
                { vraag: "Wat is de beste schatting voor de afstand tot een huis aan de overkant?", a: "1 meter", b: "5 meter", c: "10 meter", d: "50 meter", antwoord: "c", uitleg: "Een straat is ongeveer 8-12 meter breed." },
                { vraag: "Hoe hoog is een giraffe ongeveer?", a: "1 meter", b: "3 meter", c: "5 meter", d: "10 meter", antwoord: "c", uitleg: "Een giraffe is ongeveer 5-6 meter hoog." },
                { vraag: "Welke maateenheid is het best voor reisafstand tussen steden?", a: "meter", b: "centimeter", c: "kilometer", d: "millimeter", antwoord: "c", uitleg: "Reisafstanden worden in kilometers gemeten." },
                { vraag: "Wat is de beste schatting voor de breedte van een schoolbank?", a: "30 cm", b: "60 cm", c: "120 cm", d: "200 cm", antwoord: "b", uitleg: "Een schoolbank is ongeveer 50-70 cm breed." },
                { vraag: "Een tram in Nederland is ongeveer hoe lang?", a: "5 meter", b: "10 meter", c: "20 meter", d: "50 meter", antwoord: "b", uitleg: "Een tram is ongeveer 10-12 meter lang." },
                { vraag: "Welke maateenheid gebruik je voor de lengte van een basketbalveld?", a: "millimeter", b: "centimeter", c: "meter", d: "kilometer", antwoord: "c", uitleg: "Een basketbalveld is ongeveer 28 meter lang." },
                { vraag: "Een bestelwagen is 4,6 lang. In welke eenheid?", a: "millimeter", b: "centimeter", c: "meter", d: "kilometer", antwoord: "c", uitleg: "Een bestelwagen is ongeveer 4,6 meter lang." },
                { vraag: "Welke maateenheid voor de breedte van een lat?", a: "millimeter", b: "centimeter", c: "meter", d: "kilometer", antwoord: "b", uitleg: "Een lat is ongeveer 3-5 centimeter breed." },
                { vraag: "Wat is de beste schatting voor de lengte van een grote vis?", a: "9 cm", b: "30 cm", c: "90 cm", d: "200 cm", antwoord: "c", uitleg: "Een grote vis is ongeveer 90 cm lang." },
                { vraag: "Welke maateenheid is geschikt voor kleine schroefjes?", a: "kilometer", b: "meter", c: "centimeter", d: "millimeter", antwoord: "d", uitleg: "Kleine schroefjes zijn enkele millimeters groot." },
                { vraag: "Een stapel containers is ongeveer 30 hoog. Welke eenheid?", a: "millimeter", b: "centimeter", c: "meter", d: "kilometer", antwoord: "c", uitleg: "30 meter is realistisch voor containers." },
                { vraag: "Welke maateenheid voor reikwijdte van een zaklamp?", a: "millimeter", b: "centimeter", c: "meter", d: "kilometer", antwoord: "c", uitleg: "Een zaklamp schijnt tot 100-200 meter ver." },
                { vraag: "Een opbergkast is 180 hoog. In welke eenheid?", a: "millimeter", b: "centimeter", c: "meter", d: "kilometer", antwoord: "b", uitleg: "180 centimeter (1,8 meter) is normaal voor een kast." },
                { vraag: "Welke eenheid voor een reis van Nederland naar ItaliÃ«?", a: "meter", b: "centimeter", c: "kilometer", d: "millimeter", antwoord: "c", uitleg: "Reizen tussen landen zijn honderden kilometers." },
                { vraag: "Een boorbit heeft een dikte van ongeveer 6. Welke eenheid?", a: "kilometer", b: "meter", c: "centimeter", d: "millimeter", antwoord: "d", uitleg: "Een boorbit is ongeveer 6 millimeter dik." }
            ],
            waarniewaar: [
                { bewering: "Een deur is ongeveer 2 meter hoog.", antwoord: true, uitleg: "Klopt! Een standaarddeur is ongeveer 2 meter hoog." },
                { bewering: "Een giraffe is kleiner dan 1 meter.", antwoord: false, uitleg: "Fout! Een giraffe is ongeveer 5-6 meter hoog." },
                { bewering: "Voor de lengte van een potlood gebruik je centimeter.", antwoord: true, uitleg: "Klopt! Een potlood is ongeveer 19 centimeter lang." },
                { bewering: "Een voetbalveld is 500 meter lang.", antwoord: false, uitleg: "Fout! Een voetbalveld is ongeveer 100 meter lang." },
                { bewering: "Millimeter is de beste eenheid voor kleine schroefjes.", antwoord: true, uitleg: "Klopt! Kleine schroefjes zijn enkele millimeters groot." },
                { bewering: "Een auto is ongeveer 40 meter lang.", antwoord: false, uitleg: "Fout! Een auto is ongeveer 4 meter lang." },
                { bewering: "Kilometer is de beste eenheid voor een reis naar ItaliÃ«.", antwoord: true, uitleg: "Klopt! Reisafstanden zijn honderden kilometers." },
                { bewering: "Een tram is langer dan 100 meter.", antwoord: false, uitleg: "Fout! Een tram is ongeveer 10-12 meter lang." },
                { bewering: "180 centimeter is ongeveer 1,8 meter.", antwoord: true, uitleg: "Klopt! 180 cm = 1,8 meter." },
                { bewering: "De dikte van een paperclip meet je in kilometer.", antwoord: false, uitleg: "Fout! Je meet het in millimeter." },
                { bewering: "Een baby is groter dan 1 meter.", antwoord: false, uitleg: "Fout! Een baby is 50-80 cm groot." },
                { bewering: "Een boom is meestal groter dan 1 meter.", antwoord: true, uitleg: "Klopt! De meeste bomen zijn veel hoger." },
                { bewering: "Een basketbalveld meet je in meters.", antwoord: true, uitleg: "Klopt! Het is ongeveer 28 meter lang." },
                { bewering: "Een hond is groter dan een kind.", antwoord: false, uitleg: "Fout! De meeste honden zijn kleiner." },
                { bewering: "Een bestelwagen is ongeveer 4,6 meter lang.", antwoord: true, uitleg: "Klopt! Een bestelwagen is 4-5 meter lang." }
            ],
            verbind: [
                { object: "Deur", afmeting: "2 meter" },
                { object: "Auto", afmeting: "4 meter" },
                { object: "Voetbalveld", afmeting: "100 meter" },
                { object: "Tram", afmeting: "10 meter" },
                { object: "Potlood", afmeting: "19 centimeter" },
                { object: "Giraffe", afmeting: "5 meter" },
                { object: "Paperclip dikte", afmeting: "1 millimeter" },
                { object: "Opbergkast", afmeting: "180 centimeter" },
                { object: "Grote vis", afmeting: "90 centimeter" },
                { object: "Containers stapel", afmeting: "30 meter" }
            ]
        }
    },
    frans: {
        getallen: {
            mc: [
                { vraag: "Wat is 'zÃ©ro' in het Nederlands?", a: "een", b: "nul", c: "twee", d: "tien", antwoord: "b", uitleg: "ZÃ©ro = 0 (nul)" },
                { vraag: "Wat is 'trois' in het Nederlands?", a: "twee", b: "vier", c: "drie", d: "vijf", antwoord: "c", uitleg: "Trois = 3 (drie)" },
                { vraag: "Wat is 'sept' in het Nederlands?", a: "zes", b: "zeven", c: "acht", d: "negen", antwoord: "b", uitleg: "Sept = 7 (zeven)" },
                { vraag: "Wat is 'douze' in het Nederlands?", a: "twee", b: "tien", c: "twaalf", d: "veertien", antwoord: "c", uitleg: "Douze = 12 (twaalf)" },
                { vraag: "Wat is 'quinze' in het Nederlands?", a: "vijf", b: "vijftien", c: "vijftig", d: "veertien", antwoord: "b", uitleg: "Quinze = 15 (vijftien)" },
                { vraag: "Wat is 'vingt' in het Nederlands?", a: "tien", b: "vijftien", c: "twintig", d: "dertig", antwoord: "c", uitleg: "Vingt = 20 (twintig)" },
                { vraag: "Hoe zeg je '5' in het Frans?", a: "quatre", b: "cinq", c: "six", d: "sept", antwoord: "b", uitleg: "5 = cinq" },
                { vraag: "Hoe zeg je '11' in het Frans?", a: "dix", b: "douze", c: "onze", d: "treize", antwoord: "c", uitleg: "11 = onze" },
                { vraag: "Hoe zeg je '16' in het Frans?", a: "quinze", b: "seize", c: "dix-sept", d: "dix-six", antwoord: "b", uitleg: "16 = seize" },
                { vraag: "Hoe zeg je '18' in het Frans?", a: "dix-sept", b: "dix-huit", c: "dix-neuf", d: "huit", antwoord: "b", uitleg: "18 = dix-huit (tien-acht)" },
                { vraag: "Wat is 'neuf' in het Nederlands?", a: "nieuw", b: "negen", c: "negentien", d: "nul", antwoord: "b", uitleg: "Neuf = 9 (negen)" },
                { vraag: "Wat is 'quatorze' in het Nederlands?", a: "vier", b: "veertig", c: "veertien", d: "dertien", antwoord: "c", uitleg: "Quatorze = 14 (veertien)" },
                { vraag: "Hoe zeg je '8' in het Frans?", a: "sept", b: "huit", c: "neuf", d: "six", antwoord: "b", uitleg: "8 = huit" },
                { vraag: "Wat is 'treize' in het Nederlands?", a: "drie", b: "dertig", c: "dertien", d: "twintig", antwoord: "c", uitleg: "Treize = 13 (dertien)" },
                { vraag: "Hoe zeg je '19' in het Frans?", a: "dix-huit", b: "dix-neuf", c: "neuf", d: "vingt", antwoord: "b", uitleg: "19 = dix-neuf (tien-negen)" }
            ],
            waarniewaar: [
                { bewering: "ZÃ©ro betekent nul.", antwoord: true, uitleg: "Klopt! ZÃ©ro = 0" },
                { bewering: "Cinq betekent zes.", antwoord: false, uitleg: "Fout! Cinq = 5 (vijf), six = 6 (zes)" },
                { bewering: "Dix betekent tien.", antwoord: true, uitleg: "Klopt! Dix = 10" },
                { bewering: "Onze betekent ons.", antwoord: false, uitleg: "Fout! Onze = 11 (elf)" },
                { bewering: "Vingt betekent twintig.", antwoord: true, uitleg: "Klopt! Vingt = 20" },
                { bewering: "Seize betekent zestien.", antwoord: true, uitleg: "Klopt! Seize = 16" },
                { bewering: "Dix-sept betekent zeventien.", antwoord: true, uitleg: "Klopt! Dix-sept = 17 (tien-zeven)" },
                { bewering: "Quatre betekent vier.", antwoord: true, uitleg: "Klopt! Quatre = 4" },
                { bewering: "Huit betekent negen.", antwoord: false, uitleg: "Fout! Huit = 8, neuf = 9" },
                { bewering: "Douze betekent twee.", antwoord: false, uitleg: "Fout! Douze = 12, deux = 2" }
            ],
            verbind: [
                { object: "zÃ©ro", afmeting: "0" },
                { object: "un", afmeting: "1" },
                { object: "deux", afmeting: "2" },
                { object: "trois", afmeting: "3" },
                { object: "quatre", afmeting: "4" },
                { object: "cinq", afmeting: "5" },
                { object: "six", afmeting: "6" },
                { object: "sept", afmeting: "7" },
                { object: "huit", afmeting: "8" },
                { object: "neuf", afmeting: "9" },
                { object: "dix", afmeting: "10" },
                { object: "onze", afmeting: "11" },
                { object: "douze", afmeting: "12" },
                { object: "quinze", afmeting: "15" },
                { object: "vingt", afmeting: "20" }
            ],
            typen: [
                { frans: "zÃ©ro", nederlands: "0", hint: "nul" },
                { frans: "un", nederlands: "1", hint: "een" },
                { frans: "deux", nederlands: "2", hint: "twee" },
                { frans: "trois", nederlands: "3", hint: "drie" },
                { frans: "quatre", nederlands: "4", hint: "vier" },
                { frans: "cinq", nederlands: "5", hint: "vijf" },
                { frans: "six", nederlands: "6", hint: "zes" },
                { frans: "sept", nederlands: "7", hint: "zeven" },
                { frans: "huit", nederlands: "8", hint: "acht" },
                { frans: "neuf", nederlands: "9", hint: "negen" },
                { frans: "dix", nederlands: "10", hint: "tien" },
                { frans: "onze", nederlands: "11", hint: "elf" },
                { frans: "douze", nederlands: "12", hint: "twaalf" },
                { frans: "treize", nederlands: "13", hint: "dertien" },
                { frans: "quatorze", nederlands: "14", hint: "veertien" },
                { frans: "quinze", nederlands: "15", hint: "vijftien" },
                { frans: "seize", nederlands: "16", hint: "zestien" },
                { frans: "dix-sept", nederlands: "17", hint: "zeventien" },
                { frans: "dix-huit", nederlands: "18", hint: "achttien" },
                { frans: "dix-neuf", nederlands: "19", hint: "negentien" },
                { frans: "vingt", nederlands: "20", hint: "twintig" }
            ]
        },
        familie: {
            mc: [
                { vraag: "Wat betekent 'un pÃ¨re'?", a: "een moeder", b: "een vader", c: "een broer", d: "een opa", antwoord: "b", uitleg: "Un pÃ¨re = een vader" },
                { vraag: "Wat betekent 'une mÃ¨re'?", a: "een moeder", b: "een vader", c: "een zus", d: "een oma", antwoord: "a", uitleg: "Une mÃ¨re = een moeder" },
                { vraag: "Wat betekent 'un frÃ¨re'?", a: "een zus", b: "een neef", c: "een broer", d: "een oom", antwoord: "c", uitleg: "Un frÃ¨re = een broer" },
                { vraag: "Wat betekent 'une sÅ“ur'?", a: "een broer", b: "een nicht", c: "een tante", d: "een zus", antwoord: "d", uitleg: "Une sÅ“ur = een zus" },
                { vraag: "Wat betekent 'un grand-pÃ¨re'?", a: "een grote vader", b: "een grootvader/opa", c: "een oom", d: "een stiefvader", antwoord: "b", uitleg: "Un grand-pÃ¨re = een grootvader/opa" },
                { vraag: "Wat betekent 'une grand-mÃ¨re'?", a: "een grote moeder", b: "een tante", c: "een grootmoeder/oma", d: "een stiefmoeder", antwoord: "c", uitleg: "Une grand-mÃ¨re = een grootmoeder/oma" },
                { vraag: "Wat betekent 'un fils'?", a: "een dochter", b: "een zoon", c: "een neef", d: "een broer", antwoord: "b", uitleg: "Un fils = een zoon" },
                { vraag: "Wat betekent 'une fille'?", a: "een zoon", b: "een zus", c: "een dochter/meisje", d: "een nicht", antwoord: "c", uitleg: "Une fille = een dochter of meisje" },
                { vraag: "Wat betekent 'un oncle'?", a: "een oom", b: "een neef", c: "een opa", d: "een broer", antwoord: "a", uitleg: "Un oncle = een oom" },
                { vraag: "Wat betekent 'une tante'?", a: "een nicht", b: "een oma", c: "een zus", d: "een tante", antwoord: "d", uitleg: "Une tante = een tante" },
                { vraag: "Wat betekent 'un cousin'?", a: "een neef", b: "een nicht", c: "een oom", d: "een broer", antwoord: "a", uitleg: "Un cousin = een neef" },
                { vraag: "Wat betekent 'une cousine'?", a: "een neef", b: "een nicht", c: "een tante", d: "een zus", antwoord: "b", uitleg: "Une cousine = een nicht" },
                { vraag: "Wat betekent 'des parents'?", a: "grootouders", b: "kinderen", c: "ouders", d: "broers", antwoord: "c", uitleg: "Des parents = ouders" },
                { vraag: "Wat betekent 'des enfants'?", a: "ouders", b: "kinderen", c: "grootouders", d: "neven", antwoord: "b", uitleg: "Des enfants = kinderen" },
                { vraag: "Wat betekent 'un beau-pÃ¨re'?", a: "een mooie vader", b: "een stiefvader", c: "een opa", d: "een oom", antwoord: "b", uitleg: "Un beau-pÃ¨re = een stiefvader" },
                { vraag: "Wat betekent 'une belle-mÃ¨re'?", a: "een mooie moeder", b: "een oma", c: "een stiefmoeder", d: "een tante", antwoord: "c", uitleg: "Une belle-mÃ¨re = een stiefmoeder" },
                { vraag: "Wat betekent 'un demi-frÃ¨re'?", a: "een stiefbroer", b: "een halfbroer", c: "een neef", d: "een kleine broer", antwoord: "b", uitleg: "Un demi-frÃ¨re = een halfbroer" },
                { vraag: "Wat betekent 'une demi-sÅ“ur'?", a: "een stiefzus", b: "een kleine zus", c: "een halfzus", d: "een nicht", antwoord: "c", uitleg: "Une demi-sÅ“ur = een halfzus" },
                { vraag: "Hoe zeg je 'papa' in het Frans?", a: "pÃ¨re", b: "papa", c: "fils", d: "frÃ¨re", antwoord: "b", uitleg: "Papa = papa (informeel voor vader)" },
                { vraag: "Hoe zeg je 'mama' in het Frans?", a: "mÃ¨re", b: "fille", c: "maman", d: "sÅ“ur", antwoord: "c", uitleg: "Maman = mama (informeel voor moeder)" }
            ],
            waarniewaar: [
                { bewering: "Un pÃ¨re betekent een vader.", antwoord: true, uitleg: "Klopt! Un pÃ¨re = een vader" },
                { bewering: "Une mÃ¨re betekent een oma.", antwoord: false, uitleg: "Fout! Une mÃ¨re = een moeder. Oma = une grand-mÃ¨re" },
                { bewering: "Un frÃ¨re betekent een broer.", antwoord: true, uitleg: "Klopt! Un frÃ¨re = een broer" },
                { bewering: "Une sÅ“ur betekent een nicht.", antwoord: false, uitleg: "Fout! Une sÅ“ur = een zus. Nicht = une cousine" },
                { bewering: "Un grand-pÃ¨re betekent een opa.", antwoord: true, uitleg: "Klopt! Un grand-pÃ¨re = een grootvader/opa" },
                { bewering: "Un fils betekent een dochter.", antwoord: false, uitleg: "Fout! Un fils = een zoon. Dochter = une fille" },
                { bewering: "Une fille kan dochter of meisje betekenen.", antwoord: true, uitleg: "Klopt! Une fille = een dochter of een meisje" },
                { bewering: "Un oncle betekent een oom.", antwoord: true, uitleg: "Klopt! Un oncle = een oom" },
                { bewering: "Des parents betekent grootouders.", antwoord: false, uitleg: "Fout! Des parents = ouders. Grootouders = des grands-parents" },
                { bewering: "Un beau-pÃ¨re betekent een stiefvader.", antwoord: true, uitleg: "Klopt! Un beau-pÃ¨re = een stiefvader" },
                { bewering: "Un demi-frÃ¨re betekent een stiefbroer.", antwoord: false, uitleg: "Fout! Un demi-frÃ¨re = halfbroer. Stiefbroer = un beau-frÃ¨re" },
                { bewering: "Une belle-sÅ“ur betekent een stiefzus.", antwoord: true, uitleg: "Klopt! Une belle-sÅ“ur = een stiefzus" }
            ],
            verbind: [
                { object: "un pÃ¨re", afmeting: "een vader" },
                { object: "une mÃ¨re", afmeting: "een moeder" },
                { object: "un frÃ¨re", afmeting: "een broer" },
                { object: "une sÅ“ur", afmeting: "een zus" },
                { object: "un fils", afmeting: "een zoon" },
                { object: "une fille", afmeting: "een dochter" },
                { object: "un grand-pÃ¨re", afmeting: "een opa" },
                { object: "une grand-mÃ¨re", afmeting: "een oma" },
                { object: "un oncle", afmeting: "een oom" },
                { object: "une tante", afmeting: "een tante" },
                { object: "un cousin", afmeting: "een neef" },
                { object: "une cousine", afmeting: "een nicht" },
                { object: "un beau-pÃ¨re", afmeting: "een stiefvader" },
                { object: "une belle-mÃ¨re", afmeting: "een stiefmoeder" },
                { object: "un demi-frÃ¨re", afmeting: "een halfbroer" }
            ],
            typen: [
                { frans: "un pÃ¨re", nederlands: "vader", hint: "mannelijk familielid" },
                { frans: "une mÃ¨re", nederlands: "moeder", hint: "vrouwelijk familielid" },
                { frans: "un frÃ¨re", nederlands: "broer", hint: "mannelijke sibling" },
                { frans: "une sÅ“ur", nederlands: "zus", hint: "vrouwelijke sibling" },
                { frans: "un fils", nederlands: "zoon", hint: "mannelijk kind" },
                { frans: "une fille", nederlands: "dochter", hint: "vrouwelijk kind" },
                { frans: "un grand-pÃ¨re", nederlands: "opa", hint: "vader van je ouder" },
                { frans: "une grand-mÃ¨re", nederlands: "oma", hint: "moeder van je ouder" },
                { frans: "un oncle", nederlands: "oom", hint: "broer van je ouder" },
                { frans: "une tante", nederlands: "tante", hint: "zus van je ouder" },
                { frans: "un cousin", nederlands: "neef", hint: "zoon van oom/tante" },
                { frans: "une cousine", nederlands: "nicht", hint: "dochter van oom/tante" },
                { frans: "papa", nederlands: "papa", hint: "informeel voor vader" },
                { frans: "maman", nederlands: "mama", hint: "informeel voor moeder" },
                { frans: "un beau-pÃ¨re", nederlands: "stiefvader", hint: "nieuwe man van je moeder" },
                { frans: "une belle-mÃ¨re", nederlands: "stiefmoeder", hint: "nieuwe vrouw van je vader" },
                { frans: "un demi-frÃ¨re", nederlands: "halfbroer", hint: "broer met 1 gemeenschappelijke ouder" },
                { frans: "une demi-sÅ“ur", nederlands: "halfzus", hint: "zus met 1 gemeenschappelijke ouder" }
            ]
        }
    },
    natuur: {
        aanpassingen: {
            mc: [
                // Natuurlijke selectie
                { vraag: "Wat betekent natuurlijke selectie?", a: "Mensen kiezen welke dieren mogen leven", b: "De best aangepaste planten en dieren overleven", c: "Alle dieren overleven even goed", d: "Dieren kiezen zelf waar ze wonen", antwoord: "b", uitleg: "Bij natuurlijke selectie overleven de planten en dieren die het best zijn aangepast aan hun omgeving." },
                { vraag: "Waarom overleven sommige dieren beter dan andere?", a: "Omdat ze groter zijn", b: "Omdat ze ouder zijn", c: "Omdat ze beter aangepast zijn aan hun omgeving", d: "Omdat ze sneller eten", antwoord: "c", uitleg: "Dieren die goed aangepast zijn aan hun biotoop kunnen beter overleven." },
                { vraag: "Wat is een biotoop?", a: "Een soort plant", b: "De leefomgeving van planten en dieren", c: "Een dierensoort", d: "Een jachtgebied", antwoord: "b", uitleg: "Een biotoop is de natuurlijke leefomgeving waar planten en dieren leven." },
                
                // Camouflage
                { vraag: "Wat is camouflage?", a: "Heel hard kunnen roepen", b: "Dezelfde kleur aannemen als de achtergrond", c: "Heel snel kunnen rennen", d: "Heel goed kunnen zwemmen", antwoord: "b", uitleg: "Bij camouflage neemt een dier dezelfde kleur aan als zijn omgeving om niet op te vallen." },
                { vraag: "Waarom gebruiken dieren camouflage?", a: "Om er mooi uit te zien", b: "Om niet op te vallen en te overleven", c: "Om andere dieren te lokken", d: "Om warm te blijven", antwoord: "b", uitleg: "Camouflage helpt dieren om niet gezien te worden door vijanden." },
                { vraag: "Een dier doet alsof het iets anders is. Hoe noemen we dit?", a: "Camouflage", b: "Zich voordoen als iemand anders", c: "Migratie", d: "Winterrust", antwoord: "b", uitleg: "Sommige dieren doen zich voor als iets anders, zoals een wandelende tak die eruitziet als een takje." },
                { vraag: "Welk dier gebruikt camouflage door op een tak te lijken?", a: "Kikker", b: "Wandelende tak", c: "Konijn", d: "Eekhoorn", antwoord: "b", uitleg: "De wandelende tak lijkt precies op een takje en valt daardoor niet op." },
                
                // Aanpassingen planten - algemeen
                { vraag: "Waarom groeien planten naar het licht?", a: "Omdat ze van warmte houden", b: "Omdat ze licht nodig hebben om te groeien", c: "Omdat ze water zoeken", d: "Omdat ze wind willen voelen", antwoord: "b", uitleg: "Planten hebben licht nodig voor fotosynthese om te kunnen groeien." },
                { vraag: "Wat doet een zonnebloem bijzonders?", a: "Groeit alleen 's nachts", b: "Draait mee met de zon", c: "Sluit bij regen", d: "Groeit ondergronds", antwoord: "b", uitleg: "Zonnebloemen draaien mee met de zon om zoveel mogelijk licht te vangen." },
                
                // Waterplanten
                { vraag: "Hoe kan een waterlelie drijven op het water?", a: "Door haar wortels", b: "Door luchtkamers in haar bladeren", c: "Door haar bloemen", d: "Door haar stengels", antwoord: "b", uitleg: "Luchtkamers in de bladeren zorgen ervoor dat de waterlelie kan drijven." },
                { vraag: "Wat zijn luchtkamers bij een waterplant?", a: "Holtes gevuld met water", b: "Holtes gevuld met lucht", c: "Holtes gevuld met zand", d: "Holtes gevuld met aarde", antwoord: "b", uitleg: "Luchtkamers zijn kleine holtes gevuld met lucht die de plant laten drijven." },
                
                // Cactus
                { vraag: "Waarom heeft een cactus een dikke stengel?", a: "Om stevig te staan", b: "Om water op te slaan", c: "Om schaduw te geven", d: "Om mooi te zijn", antwoord: "b", uitleg: "De dikke stengel van een cactus slaat water op voor droge periodes in de woestijn." },
                { vraag: "Waarvoor heeft een cactus scherpe stekels?", a: "Om water op te slaan", b: "Om zich te beschermen tegen dieren", c: "Om zonlicht te vangen", d: "Om te klimmen", antwoord: "b", uitleg: "Stekels beschermen de cactus tegen dieren die hem willen opeten of zijn water willen." },
                { vraag: "In welke omgeving leeft een cactus?", a: "In het bos", b: "In de woestijn", c: "In het water", d: "In de sneeuw", antwoord: "b", uitleg: "Cactussen zijn aangepast om te overleven in de droge, hete woestijn." },
                
                // Stekels algemeen
                { vraag: "Welke plant heeft stekels als bescherming?", a: "Waterlelie", b: "Roos", c: "Zonnebloem", d: "Gras", antwoord: "b", uitleg: "Een roos heeft stekels om zich te beschermen tegen dieren." },
                { vraag: "Waarom hebben sommige planten stekels?", a: "Om water te verzamelen", b: "Om zich te beschermen", c: "Om te klimmen", d: "Om licht te vangen", antwoord: "b", uitleg: "Stekels zijn een aanpassing om de plant te beschermen tegen dieren." }
            ],
            waarniewaar: [
                // Natuurlijke selectie
                { bewering: "Bij natuurlijke selectie overleven de best aangepaste planten en dieren.", antwoord: true, uitleg: "Klopt! De dieren en planten die het best passen bij hun omgeving hebben de grootste kans om te overleven." },
                { bewering: "Alle planten en dieren zijn even goed aangepast.", antwoord: false, uitleg: "Fout! Sommige zijn beter aangepast dan andere, en die overleven beter." },
                { bewering: "Planten en dieren zijn aangepast aan hun omgeving om te overleven.", antwoord: true, uitleg: "Klopt! Aanpassingen helpen bij het overleven in een bepaalde omgeving." },
                
                // Camouflage
                { bewering: "Bij camouflage neemt een dier dezelfde kleur aan als de achtergrond.", antwoord: true, uitleg: "Klopt! Zo valt het dier niet op in zijn omgeving." },
                { bewering: "Camouflage wordt alleen gebruikt om er mooi uit te zien.", antwoord: false, uitleg: "Fout! Camouflage is om niet op te vallen en te overleven." },
                { bewering: "Sommige dieren doen zich voor als iets anders om niet op te vallen.", antwoord: true, uitleg: "Klopt! Zoals een wandelende tak die eruitziet als een takje." },
                { bewering: "Een wandelende tak gebruikt camouflage.", antwoord: true, uitleg: "Klopt! De wandelende tak lijkt op een echt takje." },
                
                // Planten naar licht
                { bewering: "Planten groeien naar het licht.", antwoord: true, uitleg: "Klopt! Planten hebben licht nodig om te groeien." },
                { bewering: "Zonnebloemen draaien mee met de zon.", antwoord: true, uitleg: "Klopt! Dit is een aanpassing om zoveel mogelijk licht te vangen." },
                { bewering: "Planten groeien weg van het licht.", antwoord: false, uitleg: "Fout! Planten groeien juist naar het licht toe." },
                
                // Waterplanten
                { bewering: "Een waterlelie heeft luchtkamers om te kunnen drijven.", antwoord: true, uitleg: "Klopt! De luchtkamers zorgen voor drijfvermogen." },
                { bewering: "Waterplanten drijven door hun zware wortels.", antwoord: false, uitleg: "Fout! Ze drijven door luchtkamers in hun bladeren." },
                
                // Cactus
                { bewering: "Een cactus slaat water op in zijn dikke stengel.", antwoord: true, uitleg: "Klopt! Dit helpt om te overleven in de droge woestijn." },
                { bewering: "Stekels van een cactus zijn alleen decoratie.", antwoord: false, uitleg: "Fout! Stekels beschermen de cactus tegen dieren." },
                { bewering: "Een cactus is aangepast aan het leven in de woestijn.", antwoord: true, uitleg: "Klopt! Met een dikke stengel voor water en stekels voor bescherming." },
                
                // Stekels
                { bewering: "Sommige planten hebben stekels als bescherming.", antwoord: true, uitleg: "Klopt! Zoals de cactus en de roos." },
                { bewering: "Een roos heeft stekels om water vast te houden.", antwoord: false, uitleg: "Fout! Stekels zijn voor bescherming tegen dieren." }
            ],
            verbind: [
                // Plant/Dier - Aanpassing
                { object: "Waterlelie", afmeting: "Luchtkamers om te drijven" },
                { object: "Cactus - dikke stengel", afmeting: "Water opslaan" },
                { object: "Cactus - stekels", afmeting: "Bescherming tegen dieren" },
                { object: "Zonnebloem", afmeting: "Meedraait met de zon" },
                { object: "Roos", afmeting: "Stekels voor bescherming" },
                { object: "Wandelende tak", afmeting: "Camouflage (lijkt op takje)" },
                { object: "Planten", afmeting: "Groeien naar het licht" },
                { object: "Camouflage", afmeting: "Zelfde kleur als achtergrond" },
                { object: "Natuurlijke selectie", afmeting: "Best aangepaste overleven" },
                { object: "Biotoop", afmeting: "Leefomgeving van planten/dieren" }
            ]
        }
    }
};

// ============================================================
// STORAGE
// ============================================================
const Storage = {
    KEY: '1tt5-stats-v2',
    LEADERBOARD_KEY: '1tt5-leaderboard',
    PLAYER_NAME_KEY: '1tt5-player-name',
    PLAYER_USERNAME_KEY: '1tt5-player-username',
    IS_TEACHER_KEY: '1tt5-is-teacher',
    
    // âš ï¸ VERVANG DIT MET JE EIGEN GOOGLE APPS SCRIPT URL
    GOOGLE_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbzOcUZlfmr1__KR59I7ifZp7Ze6FrQDQvxEPHaeA4y7GEdFmWJMoCaichq-iCXA0gQRnA/exec',
    
    getPlayerName() {
        return localStorage.getItem(this.PLAYER_NAME_KEY) || '';
    },
    
    setPlayerName(name) {
        localStorage.setItem(this.PLAYER_NAME_KEY, name);
    },
    
    getPlayerUsername() {
        return localStorage.getItem(this.PLAYER_USERNAME_KEY) || '';
    },
    
    setPlayerUsername(username) {
        localStorage.setItem(this.PLAYER_USERNAME_KEY, username);
    },
    
    getDisplayName() {
        // Return username if set, otherwise real name
        const username = this.getPlayerUsername();
        return username || this.getPlayerName();
    },
    
    isTeacher() {
        return localStorage.getItem(this.IS_TEACHER_KEY) === 'true';
    },
    
    setIsTeacher(isTeacher) {
        localStorage.setItem(this.IS_TEACHER_KEY, isTeacher ? 'true' : 'false');
    },
    
    get() {
        const data = localStorage.getItem(this.KEY);
        if (!data) {
            return { totalQuizzes: 0, totalQuestions: 0, totalCorrect: 0, stars: 0, topics: {} };
        }
        return JSON.parse(data);
    },
    
    save(stats) {
        localStorage.setItem(this.KEY, JSON.stringify(stats));
    },
    
    addStar() {
        const stats = this.get();
        stats.stars = (stats.stars || 0) + 1;
        this.save(stats);
        App.updateStarDisplay();
        
        // Auto-update leaderboard als speler al geregistreerd is
        const displayName = this.getDisplayName();
        if (displayName) {
            this.addToLeaderboardGoogle(displayName, stats.stars);
        }
    },
    
    updateStats(topic, correct, total, wrongQuestions = []) {
        const stats = this.get();
        stats.totalQuizzes++;
        stats.totalQuestions += total;
        stats.totalCorrect += correct;
        
        if (!stats.topics[topic]) {
            stats.topics[topic] = { quizzes: 0, questions: 0, correct: 0, best: 0, mistakes: {} };
        }
        stats.topics[topic].quizzes++;
        stats.topics[topic].questions += total;
        stats.topics[topic].correct += correct;
        
        // Track welke vragen fout zijn beantwoord
        if (!stats.topics[topic].mistakes) {
            stats.topics[topic].mistakes = {};
        }
        wrongQuestions.forEach(q => {
            // Gebruik volledige vraag als key
            stats.topics[topic].mistakes[q] = (stats.topics[topic].mistakes[q] || 0) + 1;
        });
        
        const pct = Math.round((correct / total) * 100);
        if (pct > stats.topics[topic].best) {
            stats.topics[topic].best = pct;
        }
        
        this.save(stats);
        
        // Sync stats naar Google Sheets voor leerkracht dashboard
        this.syncStatsToGoogle();
    },
    
    async syncStatsToGoogle() {
        const playerName = this.getPlayerName();
        if (!playerName) return;
        
        try {
            const stats = this.get();
            await fetch(this.GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    action: 'saveStats', 
                    name: playerName, 
                    stats: stats
                })
            });
        } catch (error) {
            console.error('Fout bij sync stats:', error);
        }
    },
    
    reset() {
        localStorage.removeItem(this.KEY);
        App.updateStarDisplay();
    },
    
    // Google Sheets Leaderboard functions
    async getLeaderboardFromGoogle() {
        try {
            if (this.GOOGLE_SCRIPT_URL === 'JOUW_GOOGLE_SCRIPT_URL_HIER') {
                console.log('Google Script URL niet geconfigureerd, gebruik lokale opslag');
                return this.getLeaderboard();
            }
            const response = await fetch(this.GOOGLE_SCRIPT_URL + '?action=getLeaderboard');
            if (!response.ok) {
                console.warn('Leaderboard ophalen mislukte, status', response.status);
                return this.getLeaderboard();
            }
            const data = await response.json();
            if (data && data.success === true && Array.isArray(data.leaderboard)) {
                return data.leaderboard;
            }
            console.warn('Leaderboard GET geen success of leaderboard array, gebruik lokale opslag');
            return this.getLeaderboard();
        } catch (error) {
            console.error('Fout bij ophalen leaderboard:', error);
            return this.getLeaderboard(); // Fallback naar lokaal
        }
    },
    
    // Synchroniseer sterren vanuit Google Sheets (als admin de sheet aanpast)
    async syncStarsFromGoogle() {
        const playerName = this.getPlayerName();
        if (!playerName) return; // Geen speler geregistreerd
        
        try {
            const leaderboard = await this.getLeaderboardFromGoogle();
            const player = leaderboard.find(e => e.name.toLowerCase() === playerName.toLowerCase());
            
            if (player) {
                const stats = this.get();
                const googleStars = parseInt(player.stars) || 0;
                
                // Update lokale sterren naar Google Sheets waarde
                if (stats.stars !== googleStars) {
                    console.log(`Sterren gesynchroniseerd: ${stats.stars} â†’ ${googleStars}`);
                    stats.stars = googleStars;
                    this.save(stats);
                    App.updateStarDisplay();
                }
            }
        } catch (error) {
            console.error('Fout bij synchroniseren sterren:', error);
        }
    },
    
    async addToLeaderboardGoogle(name, stars) {
        try {
            if (this.GOOGLE_SCRIPT_URL === 'JOUW_GOOGLE_SCRIPT_URL_HIER') {
                console.log('Google Script URL niet geconfigureerd, gebruik lokale opslag');
                return this.addToLeaderboard(name, stars);
            }
            const response = await fetch(this.GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'add', name, stars, date: new Date().toLocaleDateString('nl-BE') })
            });
            if (!response.ok) {
                console.warn('Leaderboard add mislukte met status', response.status);
                return this.addToLeaderboard(name, stars); // Fallback lokaal
            }
            const data = await response.json().catch(() => ({}));
            if (data && data.success === true) {
                return true;
            }
            console.warn('Leaderboard add geen success flag, gebruik lokale opslag');
            return this.addToLeaderboard(name, stars);
        } catch (error) {
            console.error('Fout bij toevoegen aan leaderboard:', error);
            return this.addToLeaderboard(name, stars); // Fallback naar lokaal
        }
    },
    
    // Lokale leaderboard functies (als backup)
    getLeaderboard() {
        const data = localStorage.getItem(this.LEADERBOARD_KEY);
        if (!data) return [];
        return JSON.parse(data);
    },
    
    saveLeaderboard(leaderboard) {
        localStorage.setItem(this.LEADERBOARD_KEY, JSON.stringify(leaderboard));
    },
    
    addToLeaderboard(name, stars) {
        const leaderboard = this.getLeaderboard();
        const existing = leaderboard.find(e => e.name.toLowerCase() === name.toLowerCase());
        if (existing) {
            if (stars > existing.stars) {
                existing.stars = stars;
            }
        } else {
            leaderboard.push({ name, stars, date: new Date().toLocaleDateString('nl-BE') });
        }
        leaderboard.sort((a, b) => b.stars - a.stars);
        this.saveLeaderboard(leaderboard);
        return leaderboard;
    },
    
    clearLeaderboard() {
        localStorage.removeItem(this.LEADERBOARD_KEY);
    }
};

// ============================================================
// AUTH CONTROLLER
// ============================================================
const Auth = {
    // Emoji opties voor wachtwoord
    emojis: ['ğŸ˜€', 'ğŸ˜', 'ğŸ¥³', 'ğŸ˜', 'ğŸ¤©', 'ğŸ˜‡', 'ğŸ¤ ', 'ğŸ¥¸', 'ğŸ˜º', 'ğŸ¶', 'ğŸ±', 'ğŸ¦Š', 
             'ğŸ¦', 'ğŸ¸', 'ğŸµ', 'ğŸ·', 'ğŸ»', 'ğŸ¼', 'â­', 'ğŸŒ™', 'â˜€ï¸', 'ğŸŒˆ', 'ğŸ”¥', 'ğŸ’§',
             'ğŸ', 'ğŸ•', 'ğŸ®', 'ğŸ¸', 'ğŸ¨', 'âš½', 'ğŸ€', 'ğŸ¯', 'ğŸš€', 'âœˆï¸', 'ğŸš—', 'ğŸ '],
    
    // Tijdelijke emoji selecties
    loginEmojis: [],
    registerEmojis: [],
    
    // Banned words list
    bannedWords: [
        'kut', 'kutje', 'fuck', 'shit', 'kanker', 'tering', 'tyfus', 'hoer', 'slet', 'lul', 'pik', 
        'kak', 'poep', 'damn', 'dick', 'pussy', 'bitch', 'asshole', 'bastard', 'homo', 'gay', 
        'fag', 'nigger', 'nigga', 'retard', 'idioot', 'stomme', 'domme', 'sukkel', 'loser', 
        'nazi', 'hitler', 'godver', 'verdomme', 'klote', 'klootzak', 'eikel', 'mongool', 
        'debiel', 'achterlijk', 'minkukel', 'oelewapper', 'sukop', 'droplul', 'reet', 'kont',
        'neuk', 'neuken', 'porno', 'porn', 'sex', 'seks', 'piemel', 'penis', 'vagina', 'tieten'
    ],
    
    // Initialize emoji grids
    initEmojiGrids() {
        this.renderEmojiGrid('login');
        this.renderEmojiGrid('register');
    },
    
    renderEmojiGrid(type) {
        const grid = document.getElementById(`${type}-emoji-grid`);
        if (!grid) return;
        
        grid.innerHTML = this.emojis.map(emoji => 
            `<button onclick="Auth.selectEmoji('${type}', '${emoji}')" 
                class="text-2xl p-2 rounded-lg hover:bg-indigo-100 transition-all active:scale-90">
                ${emoji}
            </button>`
        ).join('');
    },
    
    selectEmoji(type, emoji) {
        const emojis = type === 'login' ? this.loginEmojis : this.registerEmojis;
        if (emojis.length >= 3) return; // Max 3 emoji's
        
        emojis.push(emoji);
        this.updateEmojiDisplay(type);
    },
    
    clearEmojiPassword(type) {
        if (type === 'login') {
            this.loginEmojis = [];
        } else {
            this.registerEmojis = [];
        }
        this.updateEmojiDisplay(type);
    },
    
    updateEmojiDisplay(type) {
        const display = document.getElementById(`${type}-emoji-display`);
        const emojis = type === 'login' ? this.loginEmojis : this.registerEmojis;
        
        if (emojis.length === 0) {
            display.innerHTML = '<span class="text-gray-300">Kies 3 emoji\'s...</span>';
        } else {
            display.innerHTML = emojis.map(e => `<span class="text-4xl">${e}</span>`).join('');
        }
    },
    
    isLoggedIn() {
        return !!Storage.getPlayerName();
    },
    
    getCurrentUser() {
        return Storage.getDisplayName();
    },
    
    validateName(name) {
        if (!name || name.trim().length < 2) {
            return { valid: false, error: 'Naam moet minstens 2 tekens zijn' };
        }
        if (name.trim().length > 20) {
            return { valid: false, error: 'Naam mag maximaal 20 tekens zijn' };
        }
        
        // Check banned words
        const nameLower = name.toLowerCase().replace(/[0-9@!$]/g, match => {
            const replacements = {'0': 'o', '1': 'i', '3': 'e', '4': 'a', '5': 's', '@': 'a', '!': 'i', '$': 's'};
            return replacements[match] || match;
        });
        const foundBanned = this.bannedWords.find(word => nameLower.includes(word));
        if (foundBanned) {
            return { valid: false, error: 'Deze naam bevat een ongepast woord' };
        }
        
        return { valid: true };
    },
    
    showLogin() {
        this.loginEmojis = [];
        this.registerEmojis = [];
        this.updateEmojiDisplay('login');
        App.showScreen('login');
    },
    
    showRegister() {
        this.loginEmojis = [];
        this.registerEmojis = [];
        this.updateEmojiDisplay('register');
        App.showScreen('register');
    },
    
    // Check if account exists in Google Sheets
    async checkAccountExists(name) {
        try {
            const response = await fetch(Storage.GOOGLE_SCRIPT_URL + '?action=checkAccount&name=' + encodeURIComponent(name));
            const data = await response.json();
            return data;
        } catch (error) {
            console.error('Fout bij controleren account:', error);
            return { exists: false };
        }
    },
    
    // Register new account
    async register() {
        const realNameInput = document.getElementById('register-real-name');
        const nameInput = document.getElementById('register-name');
        const errorEl = document.getElementById('register-error');
        const successEl = document.getElementById('register-success');
        const registerBtn = document.getElementById('register-btn');
        const realName = realNameInput.value.trim();
        const name = nameInput.value.trim();
        
        // Prevent double click
        if (registerBtn.disabled) return;
        
        errorEl.classList.add('hidden');
        successEl.classList.add('hidden');
        
        // Validate real name
        if (!realName || realName.length < 2) {
            errorEl.textContent = 'âš ï¸ Vul je echte voornaam in (minstens 2 letters)';
            errorEl.classList.remove('hidden');
            return;
        }
        
        // Validate username only if provided
        if (name && name.length > 0) {
            const validation = this.validateName(name);
            if (!validation.valid) {
                errorEl.textContent = 'âš ï¸ ' + validation.error;
                errorEl.classList.remove('hidden');
                return;
            }
        }
        
        // Validate emoji password
        if (this.registerEmojis.length !== 3) {
            errorEl.textContent = 'âš ï¸ Kies precies 3 emoji\'s als wachtwoord';
            errorEl.classList.remove('hidden');
            return;
        }
        
        // Show loading IMMEDIATELY to prevent double clicks
        this.setLoading('register', true);
        
        // Check if real name already exists (check alleen echte naam in kolom A)
        const accountCheck = await this.checkAccountExists(realName);
        if (accountCheck.exists) {
            this.setLoading('register', false);
            errorEl.textContent = 'âš ï¸ Deze naam bestaat al. Kies een andere voornaam of gebruikersnaam.';
            errorEl.classList.remove('hidden');
            return;
        }
        
        // Create account in Google Sheets
        const emojiPassword = this.registerEmojis.join('');
        try {
            await fetch(Storage.GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    action: 'register', 
                    realName: realName,      // Kolom A
                    username: name || '',    // Kolom B
                    password: emojiPassword, // Kolom C
                    stars: 0,
                    date: new Date().toLocaleDateString('nl-BE')
                })
            });
            
            this.setLoading('register', false);
            successEl.textContent = 'âœ… Account aangemaakt! Je wordt ingelogd...';
            successEl.classList.remove('hidden');
            
            // Clear form
            realNameInput.value = '';
            nameInput.value = '';
            this.registerEmojis = [];
            this.updateEmojiDisplay('register');
            
            // Direct inloggen na registratie - sla realName en username op
            setTimeout(async () => {
                Storage.setPlayerName(realName);
                Storage.setPlayerUsername(name || '');
                
                // Toon welkom scherm met display naam (username of realName)
                const displayName = name || realName;
                document.getElementById('autologin-name').textContent = displayName;
                App.showScreen('autologin');
                
                // Ga naar home
                await App.showHome();
            }, 1000);
            
        } catch (error) {
            console.error('Fout bij registreren:', error);
            this.setLoading('register', false);
            errorEl.textContent = 'âš ï¸ Er ging iets mis. Probeer opnieuw.';
            errorEl.classList.remove('hidden');
        }
    },
    
    // Loading state helpers
    setLoading(type, loading) {
        const btn = document.getElementById(`${type}-btn`);
        const text = document.getElementById(`${type}-btn-text`);
        const spinner = document.getElementById(`${type}-spinner`);
        
        if (loading) {
            btn.disabled = true;
            btn.classList.add('opacity-75', 'cursor-wait');
            text.textContent = type === 'login' ? 'Bezig met inloggen...' : 'Account aanmaken...';
            spinner.classList.remove('hidden');
        } else {
            btn.disabled = false;
            btn.classList.remove('opacity-75', 'cursor-wait');
            text.textContent = type === 'login' ? 'ğŸ” Inloggen' : 'âœ¨ Account aanmaken';
            spinner.classList.add('hidden');
        }
    },
    
    // Login with emoji password
    async login() {
        const nameInput = document.getElementById('login-name');
        const errorEl = document.getElementById('login-error');
        const loginBtn = document.getElementById('login-btn');
        const name = nameInput.value.trim();
        
        // Prevent double click
        if (loginBtn.disabled) return;
        
        errorEl.classList.add('hidden');
        
        // Validate name
        const validation = this.validateName(name);
        if (!validation.valid) {
            errorEl.textContent = 'âš ï¸ ' + validation.error;
            errorEl.classList.remove('hidden');
            return;
        }
        
        // Validate emoji password
        if (this.loginEmojis.length !== 3) {
            errorEl.textContent = 'âš ï¸ Kies precies 3 emoji\'s als wachtwoord';
            errorEl.classList.remove('hidden');
            return;
        }
        
        // Show loading IMMEDIATELY
        this.setLoading('login', true);
        
        const emojiPassword = this.loginEmojis.join('');
        
        try {
            // Simple fetch - wait as long as needed
            const response = await fetch(
                Storage.GOOGLE_SCRIPT_URL + '?action=login&name=' + encodeURIComponent(name) + '&password=' + encodeURIComponent(emojiPassword)
            );
            
            const data = await response.json();
            
            if (!data.success) {
                this.setLoading('login', false);
                errorEl.textContent = 'âš ï¸ ' + (data.error || 'Ongeldige naam of wachtwoord');
                errorEl.classList.remove('hidden');
                this.loginEmojis = [];
                this.updateEmojiDisplay('login');
                return;
            }
            
            // Login successful!
            Storage.setPlayerName(data.realName || name);
            Storage.setPlayerUsername(data.username || '');
            
            // Save teacher status
            Storage.setIsTeacher(data.isTeacher === true);
            
            // Sync stars from Google Sheets
            await Storage.syncStarsFromGoogle();
            
            // Clear emoji selection and stop loading
            this.loginEmojis = [];
            this.setLoading('login', false);
            
            // Show home screen
            App.showHome();
            
        } catch (error) {
            console.error('Fout bij inloggen:', error);
            this.setLoading('login', false);
            errorEl.textContent = 'âš ï¸ Verbinding mislukt. Probeer opnieuw.';
            errorEl.classList.remove('hidden');
        }
    },
    
    logout() {
        if (confirm('Weet je zeker dat je wilt uitloggen?')) {
            Storage.setPlayerName('');
            this.loginEmojis = [];
            this.registerEmojis = [];
            App.showScreen('login');
            this.updateEmojiDisplay('login');
        }
    }
};

// ============================================================
// APP CONTROLLER
// ============================================================
const App = {
    currentSubject: null,
    currentTopic: null,
    currentMode: null,
    
    async init() {
        // Initialize emoji grids for login/register
        Auth.initEmojiGrids();
        
        // Check if logged in
        if (Auth.isLoggedIn()) {
            // Show auto-login screen with visual feedback
            const userName = Auth.getCurrentUser();
            document.getElementById('autologin-name').textContent = userName;
            this.showScreen('autologin');
            
            // Small delay to show the welcome message, then load home
            await new Promise(resolve => setTimeout(resolve, 800));
            await this.showHome();
        } else {
            this.showScreen('login');
        }
    },
    
    async showHome() {
        // Update user display name (shows username if set, otherwise real name)
        const userName = Auth.getCurrentUser();
        document.getElementById('user-display-name').textContent = userName;
        
        // Show teacher button if user is a teacher
        const teacherBtn = document.getElementById('teacher-dashboard-btn');
        if (Storage.isTeacher()) {
            teacherBtn.classList.remove('hidden');
            teacherBtn.classList.add('flex');
        } else {
            teacherBtn.classList.add('hidden');
            teacherBtn.classList.remove('flex');
        }
        
        // Sync stars from Google Sheets
        await Storage.syncStarsFromGoogle();
        
        this.updateStarDisplay();
        this.showScreen('home');
    },
    
    showScreen(name) {
        document.querySelectorAll('[id^="screen-"]').forEach(el => el.classList.add('hidden'));
        const screen = document.getElementById(`screen-${name}`);
        if (screen) {
            screen.classList.remove('hidden');
            screen.classList.add('fade-in');
        }
    },
    
    updateStarDisplay() {
        const stars = Storage.get().stars || 0;
        document.getElementById('star-count').textContent = stars;
        
        // Check voor game unlocks (10+ sterren)
        const gamesUnlocked = stars >= 10;
        
        const memoryBtn = document.getElementById('game-memory');
        const speedquizBtn = document.getElementById('game-speedquiz');
        const memoryLock = document.getElementById('game-memory-lock');
        const speedquizLock = document.getElementById('game-speedquiz-lock');
        
        if (memoryBtn && speedquizBtn) {
            if (gamesUnlocked) {
                memoryBtn.disabled = false;
                speedquizBtn.disabled = false;
                memoryLock.classList.add('hidden');
                speedquizLock.classList.add('hidden');
            } else {
                memoryBtn.disabled = true;
                speedquizBtn.disabled = true;
                memoryLock.classList.remove('hidden');
                speedquizLock.classList.remove('hidden');
            }
        }
    },
    
    playGame(game) {
        const stars = Storage.get().stars || 0;
        if (stars < 10) {
            alert('ğŸ”’ Je hebt minimaal 10 sterren nodig om spelletjes te spelen!');
            return;
        }
        
        if (game === 'memory') {
            this.showScreen('memory');
            Games.startMemory();
        } else if (game === 'speedquiz') {
            this.showScreen('speedquiz');
            // Reset UI maar start nog niet
            document.getElementById('speedquiz-score').textContent = '0';
            document.getElementById('speedquiz-timer').textContent = '30';
            document.getElementById('speedquiz-timer').classList.remove('timer-warning');
            document.getElementById('speedquiz-vraag').textContent = 'Druk op Start!';
            document.getElementById('speedtype-input').value = '';
            document.getElementById('speedquiz-options').classList.remove('hidden');
            document.getElementById('speedquiz-start').classList.remove('hidden');
            document.getElementById('speedquiz-complete').classList.add('hidden');
        }
    },
    
    goHome() {
        document.getElementById('modal-results').classList.add('hidden');
        // Stop game timers als die lopen
        if (Games.memoryTimer) clearInterval(Games.memoryTimer);
        if (Games.speedQuizTimer) clearInterval(Games.speedQuizTimer);
        
        // Check if still logged in
        if (Auth.isLoggedIn()) {
            this.showScreen('home');
        } else {
            this.showScreen('login');
        }
    },
    
    selectSubject(subject) {
        this.currentSubject = subject;
        const container = document.getElementById('topics-buttons');
        const title = document.getElementById('topics-title');
        container.innerHTML = '';
        
        if (subject === 'wiskunde') {
            title.textContent = 'ğŸ“ Wiskunde';
            container.innerHTML = `
                <button onclick="App.selectTopic('schatting')" class="card-hover w-full p-6 bg-gradient-to-r from-orange-100 to-pink-100 text-left rounded-2xl border-2 border-orange-200 hover:border-orange-400">
                    <span class="text-2xl font-bold text-orange-700 block">ğŸ“ Schatten & Meten</span>
                    <span class="text-orange-500 text-sm">Leer schattingen maken en maateenheden gebruiken</span>
                </button>
            `;
        } else if (subject === 'frans') {
            title.textContent = 'ğŸ‡«ğŸ‡· Frans';
            container.innerHTML = `
                <button onclick="App.selectTopic('getallen')" class="card-hover w-full p-6 bg-gradient-to-r from-blue-100 to-indigo-100 text-left rounded-2xl border-2 border-blue-200 hover:border-blue-400 mb-3">
                    <span class="text-2xl font-bold text-blue-700 block">ğŸ”¢ Getallen 0-20</span>
                    <span class="text-blue-500 text-sm">Leer de Franse getallen van nul tot twintig</span>
                </button>
                <button onclick="App.selectTopic('familie')" class="card-hover w-full p-6 bg-gradient-to-r from-pink-100 to-rose-100 text-left rounded-2xl border-2 border-pink-200 hover:border-pink-400">
                    <span class="text-2xl font-bold text-pink-700 block">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Familie</span>
                    <span class="text-pink-500 text-sm">Leer de familiewoorden in het Frans</span>
                </button>
            `;
        } else if (subject === 'natuur') {
            title.textContent = 'ğŸ¦ Natuurwetenschappen';
            container.innerHTML = `
                <button onclick="App.selectTopic('aanpassingen')" class="card-hover w-full p-6 bg-gradient-to-r from-green-100 to-emerald-100 text-left rounded-2xl border-2 border-green-200 hover:border-green-400">
                    <span class="text-2xl font-bold text-green-700 block">ğŸª Levenskringloop â€“ Aanpassingen</span>
                    <span class="text-green-500 text-sm">Aanpassingen van planten, camouflage, overleven & natuurlijke selectie</span>
                </button>
            `;
        }
        
        this.showScreen('topics');
    },
    
    goToTopics() {
        this.selectSubject(this.currentSubject);
    },
    
    selectTopic(topic) {
        this.currentTopic = topic;
        const container = document.getElementById('modes-buttons');
        const title = document.getElementById('modes-title');
        container.innerHTML = '';
        
        if (topic === 'schatting') {
            title.textContent = 'Schatten & Meten';
            container.innerHTML = `
                <button onclick="App.startQuiz('mc')" class="card-hover w-full p-5 bg-gradient-to-r from-blue-100 to-indigo-100 text-left rounded-2xl border-2 border-blue-200 hover:border-blue-400">
                    <span class="text-xl font-bold text-blue-700">âœ… Multiple Choice</span>
                    <span class="text-blue-500 text-sm block mt-1">Kies het juiste antwoord uit 4 opties</span>
                </button>
                <button onclick="App.startQuiz('waarniewaar')" class="card-hover w-full p-5 bg-gradient-to-r from-purple-100 to-pink-100 text-left rounded-2xl border-2 border-purple-200 hover:border-purple-400">
                    <span class="text-xl font-bold text-purple-700">âœ”ï¸ Waar of Niet Waar</span>
                    <span class="text-purple-500 text-sm block mt-1">Bepaal of de bewering klopt</span>
                </button>
                <button onclick="App.startQuiz('verbind')" class="card-hover w-full p-5 bg-gradient-to-r from-green-100 to-teal-100 text-left rounded-2xl border-2 border-green-200 hover:border-green-400">
                    <span class="text-xl font-bold text-green-700">ğŸ”— Verbinden</span>
                    <span class="text-green-500 text-sm block mt-1">Koppel objecten aan hun afmetingen</span>
                </button>
            `;
        } else if (topic === 'aanpassingen') {
            title.textContent = 'Aanpassingen & Zintuigen';
            container.innerHTML = `
                <button onclick="App.startQuiz('mc')" class="card-hover w-full p-5 bg-gradient-to-r from-blue-100 to-indigo-100 text-left rounded-2xl border-2 border-blue-200 hover:border-blue-400">
                    <span class="text-xl font-bold text-blue-700">âœ… Multiple Choice</span>
                    <span class="text-blue-500 text-sm block mt-1">26 vragen over dieren, planten en zintuigen</span>
                </button>
                <button onclick="App.startQuiz('waarniewaar')" class="card-hover w-full p-5 bg-gradient-to-r from-purple-100 to-pink-100 text-left rounded-2xl border-2 border-purple-200 hover:border-purple-400">
                    <span class="text-xl font-bold text-purple-700">âœ”ï¸ Waar of Niet Waar</span>
                    <span class="text-purple-500 text-sm block mt-1">24 beweringen - klopt het of niet?</span>
                </button>
                <button onclick="App.startQuiz('verbind')" class="card-hover w-full p-5 bg-gradient-to-r from-green-100 to-teal-100 text-left rounded-2xl border-2 border-green-200 hover:border-green-400">
                    <span class="text-xl font-bold text-green-700">ğŸ”— Verbinden</span>
                    <span class="text-green-500 text-sm block mt-1">Koppel dieren/planten aan hun aanpassingen</span>
                </button>
            `;
        } else if (topic === 'getallen') {
            title.textContent = 'Getallen 0-20';
            container.innerHTML = `
                <button onclick="App.startQuiz('mc')" class="card-hover w-full p-5 bg-gradient-to-r from-blue-100 to-indigo-100 text-left rounded-2xl border-2 border-blue-200 hover:border-blue-400">
                    <span class="text-xl font-bold text-blue-700">âœ… Multiple Choice</span>
                    <span class="text-blue-500 text-sm block mt-1">Vertaal Franse getallen naar Nederlands</span>
                </button>
                <button onclick="App.startQuiz('waarniewaar')" class="card-hover w-full p-5 bg-gradient-to-r from-purple-100 to-pink-100 text-left rounded-2xl border-2 border-purple-200 hover:border-purple-400">
                    <span class="text-xl font-bold text-purple-700">âœ”ï¸ Waar of Niet Waar</span>
                    <span class="text-purple-500 text-sm block mt-1">Klopt de vertaling of niet?</span>
                </button>
                <button onclick="App.startQuiz('verbind')" class="card-hover w-full p-5 bg-gradient-to-r from-green-100 to-teal-100 text-left rounded-2xl border-2 border-green-200 hover:border-green-400">
                    <span class="text-xl font-bold text-green-700">ğŸ”— Verbinden</span>
                    <span class="text-green-500 text-sm block mt-1">Koppel Frans aan het getal</span>
                </button>
                <button onclick="App.startQuiz('typen', 'fr')" class="card-hover w-full p-5 bg-gradient-to-r from-amber-100 to-orange-100 text-left rounded-2xl border-2 border-amber-200 hover:border-amber-400">
                    <span class="text-xl font-bold text-amber-700">âŒ¨ï¸ Typen (NL â†’ FR)</span>
                    <span class="text-amber-500 text-sm block mt-1">Zie het getal, typ het Franse woord</span>
                </button>
                <button onclick="App.startQuiz('typen', 'nl')" class="card-hover w-full p-5 bg-gradient-to-r from-orange-100 to-red-100 text-left rounded-2xl border-2 border-orange-200 hover:border-orange-400">
                    <span class="text-xl font-bold text-orange-700">âŒ¨ï¸ Typen (FR â†’ NL)</span>
                    <span class="text-orange-500 text-sm block mt-1">Zie het Franse woord, typ het getal</span>
                </button>
            `;
        } else if (topic === 'familie') {
            title.textContent = 'Familiewoorden';
            container.innerHTML = `
                <button onclick="App.startQuiz('mc')" class="card-hover w-full p-5 bg-gradient-to-r from-blue-100 to-indigo-100 text-left rounded-2xl border-2 border-blue-200 hover:border-blue-400">
                    <span class="text-xl font-bold text-blue-700">âœ… Multiple Choice</span>
                    <span class="text-blue-500 text-sm block mt-1">Vertaal familiewoorden Frans-Nederlands</span>
                </button>
                <button onclick="App.startQuiz('waarniewaar')" class="card-hover w-full p-5 bg-gradient-to-r from-purple-100 to-pink-100 text-left rounded-2xl border-2 border-purple-200 hover:border-purple-400">
                    <span class="text-xl font-bold text-purple-700">âœ”ï¸ Waar of Niet Waar</span>
                    <span class="text-purple-500 text-sm block mt-1">Klopt de vertaling of niet?</span>
                </button>
                <button onclick="App.startQuiz('verbind')" class="card-hover w-full p-5 bg-gradient-to-r from-green-100 to-teal-100 text-left rounded-2xl border-2 border-green-200 hover:border-green-400">
                    <span class="text-xl font-bold text-green-700">ğŸ”— Verbinden</span>
                    <span class="text-green-500 text-sm block mt-1">Koppel Frans aan Nederlands</span>
                </button>
                <button onclick="App.startQuiz('typen', 'nl')" class="card-hover w-full p-5 bg-gradient-to-r from-amber-100 to-orange-100 text-left rounded-2xl border-2 border-amber-200 hover:border-amber-400">
                    <span class="text-xl font-bold text-amber-700">âŒ¨ï¸ Typen (FR â†’ NL)</span>
                    <span class="text-amber-500 text-sm block mt-1">Zie het Franse woord, typ het Nederlandse woord</span>
                </button>
                <button onclick="App.startQuiz('typen', 'fr')" class="card-hover w-full p-5 bg-gradient-to-r from-orange-100 to-red-100 text-left rounded-2xl border-2 border-orange-200 hover:border-orange-400">
                    <span class="text-xl font-bold text-orange-700">âŒ¨ï¸ Typen (NL â†’ FR)</span>
                    <span class="text-orange-500 text-sm block mt-1">Zie het Nederlandse woord, typ het Franse woord</span>
                </button>
            `;
        }
        
        this.showScreen('modes');
    },
    
    startQuiz(mode, direction = null) {
        this.currentMode = mode;
        this.currentDirection = direction;
        Quiz.start(this.currentSubject, this.currentTopic, mode, direction);
    },
    
    restartQuiz() {
        document.getElementById('modal-results').classList.add('hidden');
        this.startQuiz(this.currentMode, this.currentDirection);
    },
    
    exitQuiz() {
        if (confirm('Weet je zeker dat je wilt stoppen?')) {
            this.goToTopics();
        }
    },
    
    showResults(score, total, wrongQuestions = []) {
        const pct = total > 0 ? Math.round((score / total) * 100) : 0;
        document.getElementById('results-score').textContent = `${score}/${total}`;
        document.getElementById('results-percentage').textContent = `${pct}% correct`;
        document.getElementById('modal-results').classList.remove('hidden');
        
        // Save stats and add star
        const topicKey = `${this.currentSubject}-${this.currentTopic}-${this.currentMode}`;
        Storage.updateStats(topicKey, score, total, wrongQuestions);
        Storage.addStar();
    },
    
    showStats() {
        const stats = Storage.get();
        document.getElementById('stats-total').textContent = stats.totalQuizzes;
        
        const avg = stats.totalQuestions > 0 
            ? Math.round((stats.totalCorrect / stats.totalQuestions) * 100) 
            : 0;
        document.getElementById('stats-average').textContent = avg + '%';
        
        const topicsContainer = document.getElementById('stats-topics');
        topicsContainer.innerHTML = '';
        
        if (Object.keys(stats.topics).length === 0) {
            topicsContainer.innerHTML = '<p class="text-center text-gray-500 py-4">Nog geen statistieken. Start een quiz!</p>';
        } else {
            Object.entries(stats.topics).forEach(([key, data]) => {
                const pct = Math.round((data.correct / data.questions) * 100);
                const mistakeCount = data.mistakes ? Object.keys(data.mistakes).length : 0;
                const totalMistakes = data.mistakes ? Object.values(data.mistakes).reduce((a, b) => a + b, 0) : 0;
                
                // Top 5 meest gemaakte fouten
                let mistakesHTML = '';
                if (data.mistakes && Object.keys(data.mistakes).length > 0) {
                    const sortedMistakes = Object.entries(data.mistakes)
                        .sort((a, b) => b[1] - a[1])
                        .slice(0, 5);
                    mistakesHTML = `
                        <div class="mt-3 pt-3 border-t border-gray-200">
                            <p class="text-sm text-red-500 font-semibold mb-2">âŒ Moeilijke vragen:</p>
                            <div class="space-y-2">
                                ${sortedMistakes.map(([q, count]) => 
                                    `<div class="bg-red-50 border border-red-200 rounded-lg p-2">
                                        <p class="text-sm text-gray-700">${q}</p>
                                        <p class="text-xs text-red-500 mt-1">${count}x fout beantwoord</p>
                                    </div>`
                                ).join('')}
                            </div>
                        </div>
                    `;
                }
                
                topicsContainer.innerHTML += `
                    <div class="bg-gray-50 p-4 rounded-xl">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-semibold text-gray-700">${key}</span>
                            <span class="text-sm bg-indigo-100 text-indigo-600 px-2 py-1 rounded-full">${data.quizzes}x</span>
                        </div>
                        <div class="flex gap-4 text-sm flex-wrap">
                            <span class="text-gray-600">Gemiddeld: <strong>${pct}%</strong></span>
                            <span class="text-green-600">Beste: <strong>${data.best}%</strong></span>
                            ${totalMistakes > 0 ? `<span class="text-red-500">Fouten: <strong>${totalMistakes}</strong></span>` : ''}
                        </div>
                        ${mistakesHTML}
                    </div>
                `;
            });
        }
        
        document.getElementById('modal-stats').classList.remove('hidden');
    },
    
    hideStats() {
        document.getElementById('modal-stats').classList.add('hidden');
    },
    
    resetStats() {
        if (confirm('Weet je zeker dat je alle statistieken wilt verwijderen?')) {
            Storage.reset();
            this.hideStats();
            alert('Statistieken zijn gereset!');
        }
    },
    
    // Leaderboard functions
    showLeaderboard() {
        const stars = Storage.get().stars || 0;
        const displayName = Storage.getDisplayName() || 'Onbekend';
        document.getElementById('current-stars-display').textContent = stars;
        document.getElementById('leaderboard-display-name').textContent = displayName;
        document.getElementById('leaderboard-list').innerHTML = '<p class="text-center text-gray-500 py-4">Laden...</p>';
        document.getElementById('modal-leaderboard').classList.remove('hidden');
        this.loadLeaderboard();
    },
    
    async loadLeaderboard() {
        const leaderboard = await Storage.getLeaderboardFromGoogle();
        this.renderLeaderboardData(leaderboard);
    },
    
    hideLeaderboard() {
        document.getElementById('modal-leaderboard').classList.add('hidden');
    },
    
    // ==================== TEACHER DASHBOARD ====================
    async showTeacherDashboard() {
        if (!Storage.isTeacher()) {
            alert('Je hebt geen leerkracht rechten.');
            return;
        }
        
        document.getElementById('modal-teacher').classList.remove('hidden');
        document.getElementById('teacher-students-list').innerHTML = '<p class="text-center text-gray-500 py-4">Laden...</p>';
        
        try {
            const response = await fetch(
                Storage.GOOGLE_SCRIPT_URL + '?action=getStudents'
            );
            const data = await response.json();
            
            if (data.success && data.students) {
                this.renderStudentsList(data.students);
            } else {
                document.getElementById('teacher-students-list').innerHTML = '<p class="text-center text-red-500 py-4">Kon leerlingen niet laden.</p>';
            }
        } catch (error) {
            console.error('Fout bij laden leerlingen:', error);
            document.getElementById('teacher-students-list').innerHTML = '<p class="text-center text-red-500 py-4">Verbinding mislukt.</p>';
        }
    },
    
    renderStudentsList(students) {
        const container = document.getElementById('teacher-students-list');
        
        // Filter alleen leerlingen (geen leerkrachten)
        const leerlingen = students.filter(s => s.isTeacher !== true && s.leerkracht !== 'ja');
        
        if (leerlingen.length === 0) {
            container.innerHTML = '<p class="text-center text-gray-500 py-4">Geen leerlingen gevonden.</p>';
            return;
        }
        
        // Sorteer op sterren (hoogste eerst)
        leerlingen.sort((a, b) => (b.stars || 0) - (a.stars || 0));
        
        container.innerHTML = leerlingen.map((student, index) => {
            const stars = student.stars || 0;
            const medal = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : 'ğŸ‘¤';
            const date = student.date || 'Onbekend';
            const stats = student.stats || null;
            const password = student.password || '';
            
            // Bereken statistieken als ze beschikbaar zijn
            let statsHTML = '';
            if (stats && stats.topics && Object.keys(stats.topics).length > 0) {
                const totalQuizzes = stats.totalQuizzes || 0;
                const avgScore = stats.totalQuestions > 0 
                    ? Math.round((stats.totalCorrect / stats.totalQuestions) * 100) 
                    : 0;
                
                // Top fouten over alle topics
                let allMistakes = [];
                Object.entries(stats.topics).forEach(([topicKey, topicData]) => {
                    if (topicData.mistakes) {
                        Object.entries(topicData.mistakes).forEach(([vraag, count]) => {
                            allMistakes.push({ topic: topicKey, vraag, count });
                        });
                    }
                });
                allMistakes.sort((a, b) => b.count - a.count);
                const topMistakes = allMistakes.slice(0, 3);
                
                // Topic details
                const topicsList = Object.entries(stats.topics).map(([key, data]) => {
                    const pct = data.questions > 0 ? Math.round((data.correct / data.questions) * 100) : 0;
                    const topicName = key.replace(/-/g, ' â†’ ').replace('wiskunde', 'ğŸ“').replace('frans', 'ğŸ‡«ğŸ‡·').replace('natuur', 'ğŸ¦');
                    return `<span class="inline-block bg-indigo-100 text-indigo-700 text-xs px-2 py-1 rounded-full mr-1 mb-1">${topicName}: ${pct}%</span>`;
                }).join('');
                
                // Fouten lijst
                let mistakesHTML = '';
                if (topMistakes.length > 0) {
                    mistakesHTML = `
                        <div class="mt-2 pt-2 border-t border-red-200">
                            <p class="text-xs text-red-600 font-semibold mb-1">âŒ Moeilijke vragen:</p>
                            ${topMistakes.map(m => `
                                <p class="text-xs text-gray-600 truncate">â€¢ ${m.vraag} <span class="text-red-500">(${m.count}x fout)</span></p>
                            `).join('')}
                        </div>
                    `;
                }
                
                statsHTML = `
                    <div class="mt-3 pt-3 border-t border-gray-200">
                        <div class="flex gap-4 text-sm mb-2">
                            <span class="text-gray-600">ğŸ“Š Quizzes: <strong>${totalQuizzes}</strong></span>
                            <span class="text-gray-600">ğŸ“ˆ Gemiddeld: <strong>${avgScore}%</strong></span>
                        </div>
                        <div class="mb-2">
                            <p class="text-xs text-gray-500 mb-1">Gemaakte oefeningen:</p>
                            ${topicsList || '<span class="text-xs text-gray-400">Nog geen oefeningen</span>'}
                        </div>
                        ${mistakesHTML}
                    </div>
                `;
            } else {
                statsHTML = `
                    <div class="mt-3 pt-3 border-t border-gray-200">
                        <p class="text-sm text-gray-400 italic">Nog geen oefeningen gemaakt</p>
                    </div>
                `;
            }
            
            return `
                <div class="bg-gradient-to-r from-gray-50 to-gray-100 p-4 rounded-xl border border-gray-200 hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">${medal}</span>
                            <div>
                                <p class="font-bold text-gray-800">${student.name}</p>
                                <p class="text-xs text-gray-500">Aangemeld: ${date}</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="text-right">
                                <p class="text-xl font-bold text-yellow-600">â­ ${stars}</p>
                                <p class="text-xs text-gray-500">sterren</p>
                            </div>
                            <button onclick="App.editStudent('${student.name.replace(/'/g, "\\'").replace(/"/g, '&quot;')}', ${stars}, '${password.replace(/'/g, "\\'").replace(/"/g, '&quot;')}')" 
                                class="p-2 bg-indigo-100 text-indigo-600 rounded-lg hover:bg-indigo-200 transition-colors" title="Bewerken">
                                âœï¸
                            </button>
                        </div>
                    </div>
                    ${statsHTML}
                </div>
            `;
        }).join('');
    },
    
    hideTeacherDashboard() {
        document.getElementById('modal-teacher').classList.add('hidden');
    },
    
    editStudent(name, stars, currentPassword = '') {
        document.getElementById('edit-student-original-name').value = name;
        document.getElementById('edit-student-name').value = name;
        document.getElementById('edit-student-stars').value = stars;
        
        // Toon huidig wachtwoord
        const currentPwDisplay = document.getElementById('current-password-display');
        if (currentPwDisplay) {
            if (currentPassword && currentPassword.length > 0) {
                currentPwDisplay.innerHTML = `<span class="text-2xl">${currentPassword}</span>`;
            } else {
                currentPwDisplay.innerHTML = '<span class="text-gray-400 text-sm">Onbekend</span>';
            }
        }
        
        this.editEmojis = [];
        this.updateEditEmojiDisplay();
        this.renderEditEmojiGrid();
        document.getElementById('modal-edit-student').classList.remove('hidden');
    },
    
    editEmojis: [],
    
    renderEditEmojiGrid() {
        const grid = document.getElementById('edit-emoji-grid');
        if (!grid) return;
        
        grid.innerHTML = Auth.emojis.map(emoji => 
            `<button type="button" onclick="App.selectEditEmoji('${emoji}')" 
                class="text-xl p-1.5 rounded-lg hover:bg-indigo-100 transition-all active:scale-90">
                ${emoji}
            </button>`
        ).join('');
    },
    
    selectEditEmoji(emoji) {
        if (this.editEmojis.length >= 3) return;
        this.editEmojis.push(emoji);
        this.updateEditEmojiDisplay();
    },
    
    clearEditEmojiPassword() {
        this.editEmojis = [];
        this.updateEditEmojiDisplay();
    },
    
    updateEditEmojiDisplay() {
        const display = document.getElementById('edit-emoji-display');
        if (!display) return;
        
        if (this.editEmojis.length === 0) {
            display.innerHTML = '<span class="text-gray-300 text-sm">Kies 3 emoji\'s om wachtwoord te resetten...</span>';
        } else {
            display.innerHTML = this.editEmojis.map(e => `<span class="text-3xl">${e}</span>`).join('');
        }
    },
    
    hideEditStudent() {
        document.getElementById('modal-edit-student').classList.add('hidden');
    },
    
    async saveStudentEdit() {
        const originalName = document.getElementById('edit-student-original-name').value;
        const newName = document.getElementById('edit-student-name').value.trim();
        const newStars = parseInt(document.getElementById('edit-student-stars').value) || 0;
        
        // Haal emoji wachtwoord op (alleen als er 3 zijn gekozen)
        let newPassword = null;
        if (this.editEmojis.length === 3) {
            newPassword = this.editEmojis.join('');
        } else if (this.editEmojis.length > 0 && this.editEmojis.length < 3) {
            alert('Kies 3 emoji\'s voor het nieuwe wachtwoord, of laat het leeg.');
            return;
        }
        
        if (!newName) {
            alert('Vul een naam in!');
            return;
        }
        
        const btn = document.getElementById('save-student-btn');
        btn.disabled = true;
        btn.innerHTML = '<span class="loading-spinner"></span> Opslaan...';
        
        try {
            const url = Storage.GOOGLE_SCRIPT_URL;
            const response = await fetch(url, {
                method: 'POST',
                body: JSON.stringify({
                    action: 'updateStudent',
                    originalName: originalName,
                    newName: newName,
                    newStars: newStars,
                    newPassword: newPassword || null
                })
            });
            
            const data = await response.json();
            
            if (data.success) {
                alert('âœ… Leerling succesvol bijgewerkt!');
                this.hideEditStudent();
                // Herlaad de lijst
                this.showTeacherDashboard();
            } else {
                alert('âŒ Fout: ' + (data.error || 'Onbekende fout'));
            }
        } catch (error) {
            console.error('Error updating student:', error);
            alert('âŒ Er ging iets mis bij het opslaan. Probeer het opnieuw.');
        } finally {
            btn.disabled = false;
            btn.innerHTML = 'ğŸ’¾ Opslaan';
        }
    },
    
    async addToLeaderboard() {
        const displayName = Storage.getDisplayName();
        
        if (!displayName) {
            alert('âš ï¸ Je moet eerst inloggen om jezelf toe te voegen aan het leaderboard!');
            return;
        }
        
        const stars = Storage.get().stars || 0;
        if (stars === 0) {
            alert('Je hebt nog geen sterren! Maak eerst een quiz af om sterren te verdienen.');
            return;
        }
        
        // Voeg toe aan Google Sheets met display name (username of realName)
        document.getElementById('leaderboard-list').innerHTML = '<p class="text-center text-gray-500 py-4">Toevoegen...</p>';
        
        const success = await Storage.addToLeaderboardGoogle(displayName, stars);
        
        // Wacht even en laad dan opnieuw
        setTimeout(() => this.loadLeaderboard(), 1500);
        
        if (success) {
            alert(`ğŸ‰ ${displayName} is toegevoegd aan het leaderboard met ${stars} sterren! Je score wordt nu automatisch bijgewerkt.`);
        } else {
            alert(`âš ï¸ Er ging iets mis bij het toevoegen. Probeer het opnieuw.`);
        }
    },
    
    renderLeaderboardData(leaderboard) {
        const container = document.getElementById('leaderboard-list');
        
        if (!leaderboard || leaderboard.length === 0) {
            container.innerHTML = '<p class="text-center text-gray-500 py-8">Nog niemand op het leaderboard. Wees de eerste!</p>';
            return;
        }
        
        // Sort by stars descending
        leaderboard.sort((a, b) => b.stars - a.stars);
        
        container.innerHTML = leaderboard.map((entry, index) => {
            let medal = '';
            let bgClass = 'bg-gray-50';
            if (index === 0) { medal = 'ğŸ¥‡'; bgClass = 'bg-gradient-to-r from-yellow-100 to-amber-100 border-2 border-yellow-300'; }
            else if (index === 1) { medal = 'ğŸ¥ˆ'; bgClass = 'bg-gradient-to-r from-gray-100 to-slate-100 border-2 border-gray-300'; }
            else if (index === 2) { medal = 'ğŸ¥‰'; bgClass = 'bg-gradient-to-r from-orange-100 to-amber-100 border-2 border-orange-300'; }
            
            return `
                <div class="${bgClass} p-4 rounded-xl flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <span class="text-2xl">${medal || `#${index + 1}`}</span>
                        <div>
                            <p class="font-bold text-gray-800">${entry.name}</p>
                            <p class="text-xs text-gray-500">${entry.date || ''}</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-1 text-yellow-600 font-bold">
                        <svg class="w-5 h-5 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.802 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.802-2.034a1 1 0 00-1.176 0l-2.802 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                        </svg>
                        ${entry.stars}
                    </div>
                </div>
            `;
        }).join('');
    },
    
    renderLeaderboard() {
        this.loadLeaderboard();
    },
    
    removeFromLeaderboard(name) {
        // Dit werkt alleen lokaal - voor Google Sheets moet je het in de sheet verwijderen
        const leaderboard = Storage.getLeaderboard();
        const filtered = leaderboard.filter(e => e.name !== name);
        Storage.saveLeaderboard(filtered);
        this.renderLeaderboardData(filtered);
    },
    
    clearLeaderboard() {
        Storage.clearLeaderboard();
        this.renderLeaderboard();
    }
};

// ============================================================
// GAMES CONTROLLER
// ============================================================
const Games = {
    // Memory Game State
    memoryCards: [],
    flippedCards: [],
    matchedPairs: 0,
    moves: 0,
    memoryTimer: null,
    memorySeconds: 0,
    
    // Speed Quiz State
    speedQuizTimer: null,
    speedQuizScore: 0,
    speedQuizTimeLeft: 30,
    speedQuizQuestions: [],
    
    // Memory card content (emoji + Nederlands woord)
    memoryPairs: [
        { emoji: 'ğŸ ', woord: 'huis' },
        { emoji: 'ğŸš—', woord: 'auto' },
        { emoji: 'ğŸ“š', woord: 'boek' },
        { emoji: 'ğŸ', woord: 'appel' },
        { emoji: 'â˜€ï¸', woord: 'zon' },
        { emoji: 'ğŸŒ™', woord: 'maan' },
        { emoji: 'ğŸ•', woord: 'hond' },
        { emoji: 'ğŸˆ', woord: 'kat' }
    ],
    
    // Speed Type woorden
    speedTypeWords: [
        'cactus', 'woestijn', 'water', 'stekels', 'plant', 'dier', 'zon', 'regen',
        'camouflage', 'overleven', 'biotoop', 'natuur', 'boom', 'bloem', 'blad',
        'wortel', 'stengel', 'groeien', 'licht', 'warm', 'koud', 'droog', 'nat',
        'school', 'leren', 'quiz', 'spel', 'punten', 'score', 'timer', 'snel',
        'toets', 'vraag', 'antwoord', 'goed', 'fout', 'probeer', 'opnieuw'
    ],
    currentWord: '',
    typedCorrect: 0,
    
    startMemory() {
        this.memoryCards = [];
        this.flippedCards = [];
        this.matchedPairs = 0;
        this.moves = 0;
        this.memorySeconds = 0;
        
        // Stop bestaande timer
        if (this.memoryTimer) clearInterval(this.memoryTimer);
        
        // Maak kaartjes (8 paren = 16 kaarten)
        const pairs = this.memoryPairs.slice(0, 8);
        pairs.forEach((pair, index) => {
            this.memoryCards.push({ id: index * 2, content: pair.emoji, pairId: index, type: 'emoji' });
            this.memoryCards.push({ id: index * 2 + 1, content: pair.woord, pairId: index, type: 'text' });
        });
        
        // Shuffle
        this.memoryCards = this.memoryCards.sort(() => Math.random() - 0.5);
        
        // Render
        this.renderMemoryGrid();
        
        // Start timer
        document.getElementById('memory-timer').textContent = '0:00';
        document.getElementById('memory-moves').textContent = '0';
        document.getElementById('memory-complete').classList.add('hidden');
        
        this.memoryTimer = setInterval(() => {
            this.memorySeconds++;
            const mins = Math.floor(this.memorySeconds / 60);
            const secs = this.memorySeconds % 60;
            document.getElementById('memory-timer').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
        }, 1000);
    },
    
    renderMemoryGrid() {
        const grid = document.getElementById('memory-grid');
        grid.innerHTML = this.memoryCards.map((card, index) => `
            <button onclick="Games.flipCard(${index})" 
                id="memory-card-${index}"
                class="aspect-square bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center text-xl font-bold text-white shadow-lg hover:scale-105 transition-all cursor-pointer p-1 overflow-hidden"
                data-flipped="false" data-matched="false">
                <span class="text-2xl">?</span>
            </button>
        `).join('');
    },
    
    flipCard(index) {
        const card = this.memoryCards[index];
        const cardEl = document.getElementById(`memory-card-${index}`);
        
        // Niet flippen als al geflipped of gematcht
        if (cardEl.dataset.flipped === 'true' || cardEl.dataset.matched === 'true') return;
        if (this.flippedCards.length >= 2) return;
        
        // Flip de kaart - pas tekstgrootte aan op lengte
        cardEl.dataset.flipped = 'true';
        cardEl.classList.remove('from-indigo-500', 'to-purple-600', 'text-white', 'bg-gradient-to-br');
        cardEl.classList.add('border-2', 'border-indigo-400');
        cardEl.style.background = '#ffffff';
        
        // Kleinere tekst voor langere woorden - donkerblauwe kleur
        const textSize = card.content.length > 6 ? 'text-xs sm:text-sm' : 
                        card.content.length > 4 ? 'text-sm sm:text-base' : 'text-base sm:text-lg';
        cardEl.innerHTML = `<span class="${textSize} text-center leading-tight break-all font-bold" style="color: #3730a3;">${card.content}</span>`;
        
        this.flippedCards.push({ index, card });
        
        // Check voor match als 2 kaarten geflipped
        if (this.flippedCards.length === 2) {
            this.moves++;
            document.getElementById('memory-moves').textContent = this.moves;
            
            const [first, second] = this.flippedCards;
            
            if (first.card.pairId === second.card.pairId) {
                // Match!
                document.getElementById(`memory-card-${first.index}`).dataset.matched = 'true';
                document.getElementById(`memory-card-${second.index}`).dataset.matched = 'true';
                document.getElementById(`memory-card-${first.index}`).classList.remove('bg-white', 'border-indigo-300');
                document.getElementById(`memory-card-${second.index}`).classList.remove('bg-white', 'border-indigo-300');
                document.getElementById(`memory-card-${first.index}`).classList.add('bg-green-100', 'border-green-500');
                document.getElementById(`memory-card-${second.index}`).classList.add('bg-green-100', 'border-green-500');
                this.matchedPairs++;
                this.flippedCards = [];
                
                // Check voor winst
                if (this.matchedPairs === 8) {
                    clearInterval(this.memoryTimer);
                    const mins = Math.floor(this.memorySeconds / 60);
                    const secs = this.memorySeconds % 60;
                    document.getElementById('memory-final-moves').textContent = this.moves;
                    document.getElementById('memory-final-time').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
                    document.getElementById('memory-complete').classList.remove('hidden');
                }
            } else {
                // Geen match - flip terug na delay
                setTimeout(() => {
                    const card1El = document.getElementById(`memory-card-${first.index}`);
                    const card2El = document.getElementById(`memory-card-${second.index}`);
                    card1El.dataset.flipped = 'false';
                    card2El.dataset.flipped = 'false';
                    card1El.classList.remove('border-2', 'border-indigo-400');
                    card2El.classList.remove('border-2', 'border-indigo-400');
                    card1El.classList.add('from-indigo-500', 'to-purple-600', 'text-white', 'bg-gradient-to-br');
                    card2El.classList.add('from-indigo-500', 'to-purple-600', 'text-white', 'bg-gradient-to-br');
                    card1El.style.background = '';
                    card2El.style.background = '';
                    card1El.innerHTML = '<span class="text-2xl">?</span>';
                    card2El.innerHTML = '<span class="text-2xl">?</span>';
                    this.flippedCards = [];
                }, 1000);
            }
        }
    },
    
    startSpeedQuiz() {
        this.speedQuizScore = 0;
        this.speedQuizTimeLeft = 30;
        this.typedCorrect = 0;
        
        // Stop bestaande timer
        if (this.speedQuizTimer) clearInterval(this.speedQuizTimer);
        
        // UI Reset
        document.getElementById('speedquiz-score').textContent = '0';
        document.getElementById('speedquiz-timer').textContent = '30';
        document.getElementById('speedquiz-timer').classList.remove('timer-warning');
        document.getElementById('speedquiz-start').classList.add('hidden');
        document.getElementById('speedquiz-complete').classList.add('hidden');
        document.getElementById('speedquiz-options').classList.remove('hidden');
        
        // Setup input
        const input = document.getElementById('speedtype-input');
        input.value = '';
        input.focus();
        
        // Event listener voor typen
        input.onkeydown = (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                this.checkTypedWord();
            }
        };
        
        // Start timer
        this.speedQuizTimer = setInterval(() => {
            this.speedQuizTimeLeft--;
            const timerEl = document.getElementById('speedquiz-timer');
            timerEl.textContent = this.speedQuizTimeLeft;
            
            // Warning styling als tijd laag is
            if (this.speedQuizTimeLeft <= 10) {
                timerEl.classList.add('timer-warning');
            } else {
                timerEl.classList.remove('timer-warning');
            }
            
            if (this.speedQuizTimeLeft <= 0) {
                this.endSpeedQuiz();
            }
        }, 1000);
        
        // Eerste woord
        this.showNextWord();
    },
    
    showNextWord() {
        // Kies een willekeurig woord
        const randomIndex = Math.floor(Math.random() * this.speedTypeWords.length);
        this.currentWord = this.speedTypeWords[randomIndex];
        document.getElementById('speedquiz-vraag').textContent = this.currentWord;
    },
    
    checkTypedWord() {
        const input = document.getElementById('speedtype-input');
        const typed = input.value.trim().toLowerCase();
        
        if (typed === this.currentWord.toLowerCase()) {
            // Correct!
            this.typedCorrect++;
            document.getElementById('speedquiz-score').textContent = this.typedCorrect;
            
            // Flash groen
            input.classList.add('border-green-500', 'bg-green-50');
            setTimeout(() => {
                input.classList.remove('border-green-500', 'bg-green-50');
            }, 200);
        } else {
            // Fout - flash rood
            input.classList.add('border-red-500', 'bg-red-50');
            setTimeout(() => {
                input.classList.remove('border-red-500', 'bg-red-50');
            }, 200);
        }
        
        // Reset en volgende woord
        input.value = '';
        this.showNextWord();
    },
    
    endSpeedQuiz() {
        clearInterval(this.speedQuizTimer);
        document.getElementById('speedquiz-options').classList.add('hidden');
        document.getElementById('speedquiz-final-score').textContent = this.typedCorrect;
        document.getElementById('speedquiz-complete').classList.remove('hidden');
        document.getElementById('speedquiz-start').classList.remove('hidden');
        
        // Remove event listener
        const input = document.getElementById('speedtype-input');
        if (input) input.onkeydown = null;
    }
};

// ============================================================
// QUIZ CONTROLLER
// ============================================================
const Quiz = {
    questions: [],
    currentIndex: 0,
    score: 0,
    answered: false,
    
    // Matching game state
    matchPairs: [],
    selectedLeft: null,
    selectedRight: null,
    matchedCount: 0,
    
    // Track wrong answers
    wrongQuestions: [],
    retryQuestions: [],
    originalQuestionCount: 0,
    
    start(subject, topic, mode, direction = null) {
        this.questions = [];
        this.currentIndex = 0;
        this.score = 0;
        this.answered = false;
        this.wrongQuestions = [];
        this.retryQuestions = [];
        this.direction = direction; // 'nl' = FRâ†’NL, 'fr' = NLâ†’FR
        
        const data = DATA[subject]?.[topic];
        if (!data) {
            alert('Geen data beschikbaar voor dit onderwerp');
            return;
        }
        
        // Set title
        let title = 'Quiz';
        if (topic === 'schatting') {
            if (mode === 'mc') title = 'Schatten & Meten - Multiple Choice';
            if (mode === 'waarniewaar') title = 'Schatten & Meten - Waar of Niet Waar';
            if (mode === 'verbind') title = 'Schatten & Meten - Verbinden';
        } else if (topic === 'getallen') {
            if (mode === 'mc') title = 'Getallen 0-20 - Multiple Choice';
            if (mode === 'waarniewaar') title = 'Getallen 0-20 - Waar of Niet Waar';
            if (mode === 'verbind') title = 'Getallen 0-20 - Verbinden';
            if (mode === 'typen') title = direction === 'fr' ? 'Getallen 0-20 - NL â†’ Frans' : 'Getallen 0-20 - Frans â†’ NL';
        } else if (topic === 'familie') {
            if (mode === 'mc') title = 'Familiewoorden - Multiple Choice';
            if (mode === 'waarniewaar') title = 'Familiewoorden - Waar of Niet Waar';
            if (mode === 'verbind') title = 'Familiewoorden - Verbinden';
            if (mode === 'typen') title = direction === 'fr' ? 'Familiewoorden - NL â†’ Frans' : 'Familiewoorden - Frans â†’ NL';
        } else if (topic === 'aanpassingen') {
            if (mode === 'mc') title = 'Aanpassingen - Multiple Choice';
            if (mode === 'waarniewaar') title = 'Aanpassingen - Waar of Niet Waar';
            if (mode === 'verbind') title = 'Aanpassingen - Verbinden';
        }
        document.getElementById('quiz-title').textContent = title;
        
        // Handle different modes
        if (mode === 'mc') {
            this.setupMC(data.mc);
        } else if (mode === 'waarniewaar') {
            this.setupWaarNietWaar(data.waarniewaar);
        } else if (mode === 'verbind') {
            this.setupMatching(data.verbind);
            return;
        } else if (mode === 'typen') {
            this.setupTypen(data.typen);
        }
        
        App.showScreen('quiz');
        this.showQuestion();
    },
    
    setupMC(data) {
        this.questions = data.map(item => {
            const correct = item[item.antwoord];
            let options = [item.a, item.b, item.c, item.d];
            this.shuffle(options);
            return {
                vraag: item.vraag,
                antwoord: correct,
                options: options,
                uitleg: item.uitleg,
                type: 'mc'
            };
        });
        this.shuffle(this.questions);
        this.originalQuestionCount = this.questions.length;
    },
    
    setupWaarNietWaar(data) {
        this.questions = data.map(item => ({
            vraag: item.bewering,
            antwoord: item.antwoord ? 'Waar' : 'Niet Waar',
            options: ['Waar', 'Niet Waar'],
            uitleg: item.uitleg,
            type: 'mc'
        }));
        this.shuffle(this.questions);
        this.originalQuestionCount = this.questions.length;
    },
    
    setupTypen(data) {
        // direction: 'nl' = FRâ†’NL (typ Nederlands), 'fr' = NLâ†’FR (typ Frans)
        if (this.direction === 'fr') {
            // NL â†’ FR: toont Nederlands/hint, vraagt Frans
            this.questions = data.map(item => ({
                vraag: `Hoe zeg je "${item.hint || item.nederlands}" in het Frans?`,
                antwoord: item.frans.toLowerCase(),
                hint: item.nederlands,
                frans: item.frans,
                uitleg: `${item.hint || item.nederlands} = ${item.frans}`,
                type: 'typen'
            }));
        } else {
            // FR â†’ NL: toont Frans, vraagt Nederlands (standaard)
            this.questions = data.map(item => ({
                vraag: `Vertaal: "${item.frans}"`,
                antwoord: item.nederlands.toLowerCase(),
                hint: item.hint,
                frans: item.frans,
                uitleg: `${item.frans} = ${item.nederlands}`,
                type: 'typen'
            }));
        }
        this.shuffle(this.questions);
        this.originalQuestionCount = this.questions.length;
    },
    
    setupMatching(data) {
        this.matchPairs = data.slice(0, 6).map(item => ({
            left: item.object,
            right: item.afmeting
        }));
        this.selectedLeft = null;
        this.selectedRight = null;
        this.matchedCount = 0;
        this.score = 0;
        
        // Hide other elements
        document.getElementById('mc-options').classList.add('hidden');
        document.getElementById('typing-area').classList.add('hidden');
        document.getElementById('question-card').classList.add('hidden');
        document.getElementById('matching-area').classList.remove('hidden');
        document.getElementById('feedback-area').innerHTML = '';
        
        // Create buttons
        const leftCol = document.getElementById('match-left');
        const rightCol = document.getElementById('match-right');
        leftCol.innerHTML = '';
        rightCol.innerHTML = '';
        
        // Shuffle right column
        const rightItems = [...this.matchPairs.map(p => p.right)];
        this.shuffle(rightItems);
        
        this.matchPairs.forEach((pair, i) => {
            const leftBtn = document.createElement('button');
            leftBtn.textContent = pair.left;
            leftBtn.className = 'match-btn w-full p-4 bg-orange-100 text-orange-800 rounded-xl font-semibold border-2 border-orange-300 hover:bg-orange-200';
            leftBtn.dataset.index = i;
            leftBtn.onclick = () => this.selectMatch(leftBtn, 'left', i);
            leftCol.appendChild(leftBtn);
        });
        
        rightItems.forEach((text, displayIndex) => {
            const originalIndex = this.matchPairs.findIndex(p => p.right === text);
            const rightBtn = document.createElement('button');
            rightBtn.textContent = text;
            rightBtn.className = 'match-btn w-full p-4 bg-green-100 text-green-800 rounded-xl font-semibold border-2 border-green-300 hover:bg-green-200';
            rightBtn.dataset.index = originalIndex;
            rightBtn.onclick = () => this.selectMatch(rightBtn, 'right', originalIndex);
            rightCol.appendChild(rightBtn);
        });
        
        this.updateMatchProgress();
        App.showScreen('quiz');
    },
    
    selectMatch(btn, side, index) {
        if (btn.classList.contains('matched')) return;
        
        // Remove previous selection
        if (side === 'left' && this.selectedLeft) {
            this.selectedLeft.classList.remove('ring-4', 'ring-orange-500', 'scale-105');
        }
        if (side === 'right' && this.selectedRight) {
            this.selectedRight.classList.remove('ring-4', 'ring-green-500', 'scale-105');
        }
        
        // Set new selection
        if (side === 'left') {
            this.selectedLeft = btn;
            btn.classList.add('ring-4', 'ring-orange-500', 'scale-105');
        } else {
            this.selectedRight = btn;
            btn.classList.add('ring-4', 'ring-green-500', 'scale-105');
        }
        
        // Check if both selected
        if (this.selectedLeft && this.selectedRight) {
            this.checkMatch();
        }
    },
    
    checkMatch() {
        const leftIndex = parseInt(this.selectedLeft.dataset.index);
        const rightIndex = parseInt(this.selectedRight.dataset.index);
        const feedback = document.getElementById('feedback-area');
        
        if (leftIndex === rightIndex) {
            // Correct!
            this.score++;
            this.matchedCount++;
            
            this.selectedLeft.classList.remove('ring-4', 'ring-orange-500', 'scale-105');
            this.selectedRight.classList.remove('ring-4', 'ring-green-500', 'scale-105');
            this.selectedLeft.classList.add('matched', 'opacity-50', 'bg-green-200', 'border-green-400');
            this.selectedRight.classList.add('matched', 'opacity-50', 'bg-green-200', 'border-green-400');
            
            feedback.innerHTML = '<p class="text-green-600 font-bold text-lg text-center">âœ… Correct!</p>';
            
            this.selectedLeft = null;
            this.selectedRight = null;
            
            this.updateMatchProgress();
            
            // Check if done
            if (this.matchedCount === this.matchPairs.length) {
                setTimeout(() => {
                    App.showResults(this.score, this.matchPairs.length);
                }, 800);
            }
        } else {
            // Wrong
            feedback.innerHTML = '<p class="text-red-600 font-bold text-lg text-center">âŒ Fout! Probeer opnieuw.</p>';
            
            setTimeout(() => {
                this.selectedLeft.classList.remove('ring-4', 'ring-orange-500', 'scale-105');
                this.selectedRight.classList.remove('ring-4', 'ring-green-500', 'scale-105');
                this.selectedLeft = null;
                this.selectedRight = null;
                feedback.innerHTML = '';
            }, 800);
        }
    },
    
    updateMatchProgress() {
        document.getElementById('quiz-progress').textContent = `${this.matchedCount} van ${this.matchPairs.length} gekoppeld`;
        document.getElementById('quiz-score').textContent = `Score: ${this.score}/${this.matchedCount}`;
        document.getElementById('quiz-progress-bar').style.width = `${(this.matchedCount / this.matchPairs.length) * 100}%`;
    },
    
    showQuestion() {
        // Als alle vragen beantwoord zijn, voeg retry vragen toe
        if (this.currentIndex >= this.questions.length) {
            if (this.retryQuestions.length > 0) {
                // Voeg foute vragen toe voor een nieuwe poging
                this.questions = this.questions.concat(this.retryQuestions);
                this.retryQuestions = []; // Reset voor volgende ronde
            } else {
                // Echt klaar - toon resultaten
                App.showResults(this.score, this.originalQuestionCount, this.wrongQuestions);
                return;
            }
        }
        
        this.answered = false;
        const q = this.questions[this.currentIndex];
        
        // Reset UI
        document.getElementById('question-card').classList.remove('hidden');
        document.getElementById('matching-area').classList.add('hidden');
        document.getElementById('feedback-area').innerHTML = '';
        
        // Set question
        document.getElementById('question-label').textContent = `Vraag ${this.currentIndex + 1}:`;
        document.getElementById('question-text').textContent = q.vraag;
        
        // Show correct input type based on question type
        if (q.type === 'typen') {
            // Typen modus
            document.getElementById('mc-options').classList.add('hidden');
            document.getElementById('typing-area').classList.remove('hidden');
            
            const input = document.getElementById('answer-input');
            input.value = '';
            input.placeholder = q.hint ? `Hint: ${q.hint}` : 'Typ je antwoord...';
            input.focus();
            
            // Allow Enter key to submit
            input.onkeydown = (e) => {
                if (e.key === 'Enter') {
                    this.checkTypedAnswer();
                }
            };
        } else {
            // MC modus
            document.getElementById('mc-options').classList.remove('hidden');
            document.getElementById('typing-area').classList.add('hidden');
            
            const optionsContainer = document.getElementById('mc-options');
            optionsContainer.innerHTML = '';
            
            q.options.forEach(option => {
                const btn = document.createElement('button');
                btn.textContent = option;
                btn.className = 'option-btn w-full p-4 bg-white text-gray-800 rounded-xl border-2 border-gray-200 font-medium text-lg text-left';
                btn.onclick = () => this.checkAnswer(btn, option, q.antwoord, q.uitleg);
                optionsContainer.appendChild(btn);
            });
        }
        
        this.updateProgress();
    },
    
    checkTypedAnswer() {
        if (this.answered) return;
        this.answered = true;
        
        const input = document.getElementById('answer-input');
        const typed = input.value.trim().toLowerCase();
        const q = this.questions[this.currentIndex];
        const correct = q.antwoord.toLowerCase();
        
        // Check answer (allow some flexibility)
        const isCorrect = typed === correct || 
                         typed === correct.replace(/een /g, '') ||
                         typed === correct.replace('een ', '');
        
        const feedback = document.getElementById('feedback-area');
        let feedbackHTML = '';
        
        input.disabled = true;
        document.getElementById('check-btn').disabled = true;
        
        if (isCorrect) {
            this.score++;
            input.classList.add('border-green-500', 'bg-green-50');
            feedbackHTML = `<p class="text-green-600 font-bold text-lg">âœ… Correct!</p>`;
        } else {
            // Track de fout
            this.wrongQuestions.push(q.vraag);
            this.retryQuestions.push(q);
            
            input.classList.add('border-red-500', 'bg-red-50');
            feedbackHTML = `
                <p class="text-red-600 font-bold text-lg">âŒ Fout!</p>
                <p class="text-gray-600 mt-1">Jouw antwoord: <span class="text-red-600">${typed || '(leeg)'}</span></p>
                <p class="text-gray-600">Juiste antwoord: <span class="text-green-600 font-semibold">${q.antwoord}</span></p>
            `;
        }
        
        feedbackHTML += `<p class="text-gray-500 text-sm mt-2">${q.uitleg}</p>`;
        feedbackHTML += `<button onclick="Quiz.nextQuestion()" class="mt-4 w-full btn-primary text-white font-bold py-3 rounded-xl">Volgende vraag â†’</button>`;
        
        feedback.innerHTML = feedbackHTML;
    },
    
    checkAnswer(btn, selected, correct, uitleg) {
        if (this.answered) return;
        this.answered = true;
        
        const currentQuestion = this.questions[this.currentIndex];
        
        const buttons = document.querySelectorAll('#mc-options button');
        buttons.forEach(b => {
            b.disabled = true;
            if (b.textContent === correct) {
                b.classList.add('option-correct');
            } else if (b === btn && selected !== correct) {
                b.classList.add('option-wrong');
            }
        });
        
        const feedback = document.getElementById('feedback-area');
        let feedbackHTML = '';
        
        if (selected === correct) {
            this.score++;
            feedbackHTML = '<p class="text-green-600 font-bold text-lg">âœ… Correct!</p>';
        } else {
            // Track de fout
            this.wrongQuestions.push(currentQuestion.vraag);
            
            // Voeg vraag toe aan retry lijst (komt later terug)
            if (!currentQuestion.isRetry) {
                const retryQuestion = { ...currentQuestion, isRetry: true };
                this.retryQuestions.push(retryQuestion);
            }
            
            feedbackHTML = `<p class="text-red-600 font-bold text-lg">âŒ Fout!</p>
                           <p class="text-gray-600 mt-1">Het juiste antwoord is: <strong>${correct}</strong></p>`;
            
            if (!currentQuestion.isRetry) {
                feedbackHTML += `<p class="text-orange-500 text-sm mt-2">ğŸ”„ Deze vraag komt later terug!</p>`;
            }
        }
        
        if (uitleg) {
            feedbackHTML += `<p class="mt-3 p-3 bg-blue-50 rounded-xl text-sm text-blue-700 border-l-4 border-blue-500"><strong>Uitleg:</strong> ${uitleg}</p>`;
        }
        
        feedbackHTML += `<button onclick="Quiz.nextQuestion()" class="mt-4 w-full btn-primary text-white font-bold py-3 rounded-xl">
            Volgende vraag â†’
        </button>`;
        
        feedback.innerHTML = feedbackHTML;
        this.updateProgress();
    },
    
    nextQuestion() {
        // Reset typing input
        const input = document.getElementById('answer-input');
        input.disabled = false;
        input.value = '';
        input.classList.remove('border-green-500', 'bg-green-50', 'border-red-500', 'bg-red-50');
        document.getElementById('check-btn').disabled = false;
        
        this.currentIndex++;
        this.showQuestion();
    },
    
    updateProgress() {
        const total = this.questions.length;
        const current = Math.min(this.currentIndex + 1, total);
        
        document.getElementById('quiz-progress').textContent = `Vraag ${current} van ${total}`;
        document.getElementById('quiz-score').textContent = `Score: ${this.score}/${this.currentIndex + (this.answered ? 1 : 0)}`;
        document.getElementById('quiz-progress-bar').style.width = `${(this.currentIndex / total) * 100}%`;
    },
    
    shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }
};

// ============================================================
// INIT
// ============================================================
document.addEventListener('DOMContentLoaded', () => App.init());
</script>

</body>
</html>
